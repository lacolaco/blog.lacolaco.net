---
title: 'CircleCIからGitHub Actionsへの移行 (Node.js)'
date: '2019-09-16T00:00:00.000Z'
tags:
  - 'tech'
  - 'GitHub Actions'
published: true
source: 'https://www.notion.so/CircleCI-GitHub-Actions-Node-js-b989169bf9a4470a9aae9eb49a823e4a'
---

import LinkPreview from '../../components/features/LinkPreview.astro';

自作のライブラリの CI を CircleCI から GitHub Actions へ移行したメモ

<LinkPreview src="https://github.com/lacolaco/reactive-store" />

<LinkPreview src="https://github.com/lacolaco/reactive-store/pull/80" />

特にメリットがあるから乗り換えたとかいうわけでもないけど、GitHub だけで完結するならそれに越したことはない

## ファイルの場所

`.github/workflows/&lt;ワークフローの名前&gt;.yml` だが、いまのところ複数作るユースケースが見えないので `main.yml` とした。

## 実行環境

`ubuntu-latest` を選択した。特に理由はないけど一応 MacOS や Windows も選べるっぽい？

https://help.github.com/en/articles/software-in-virtual-environments-for-github-actions#ubuntu-1804-lts を見るとわかるが、 めちゃくちゃ充実したプリインのソフトウェアがある。 `yarn` や Git、Docker、Chrome もなんの設定もなく最初から使えるのはよい。

今回の移行ではもともと `circleci/node:carbon-browsers` を使っていたけど、 `ubuntu-latest` だけで事足りた。 Node.js のバージョン指定は `node-version: [12.x]` のところでマトリックスにできるので、実行環境とは切り離して考えられる。

## 全体

```plaintext
name: Main

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [12.x]

    steps:
    - uses: actions/checkout@v1
    - name: Run tests with ${{ matrix.node-version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node-version }}
    - name: npm install, build, and test
      run: |
        yarn install
        yarn build
        yarn lint
        yarn test:ci
      env:
        CI: true
```

もともと大したことをやってないので、あっというまに置き換えが終わった。

## ポイント

- `yarn` は最初から入ってるから気にしなくていい (現在は 1.17.3 っぽいが多分 latest 追従だろうか)
- Chrome も最初から入ってるから気にしなくていい (Headless はまだ試してない）
- Node.js のバージョン指定は `actions/setup-node` の引数で変えられる
