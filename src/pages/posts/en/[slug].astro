---
import { type CollectionEntry, getCollection } from 'astro:content';
import PostDetailPage from '../../../layouts/PostDetailPage.astro';
import { queryAvailablePosts, queryAdjacentPosts } from '@lib/query';

export async function getStaticPaths() {
  const allPosts = await queryAvailablePosts();
  const posts = await getCollection('postsV2');
  return posts
    .filter((post) => post.data.locale === 'en')
    .map((post) => {
      // ビルド時に隣接記事を事前計算（全ロケールを対象）
      const adjacentPosts = queryAdjacentPosts(allPosts, post.data.slug);
      return {
        params: {
          slug: post.data.slug,
        },
        props: {
          entry: post,
          adjacentPosts,
        },
      };
    });
}
type Props = {
  entry: CollectionEntry<'postsV2'>;
  adjacentPosts: {
    prev: CollectionEntry<'postsV2'> | null;
    next: CollectionEntry<'postsV2'> | null;
  };
};
const { entry, adjacentPosts } = Astro.props;
---

<PostDetailPage entry={entry} adjacentPosts={adjacentPosts} />
