---
import { type CollectionEntry } from 'astro:content';
import PostDetailPage from 'src/layouts/PostDetailPage.astro';
import { queryAvailablePosts, queryAdjacentPosts } from '@lib/query';

export async function getStaticPaths() {
  const posts = await queryAvailablePosts();
  return posts.map((entry) => {
    // ビルド時に隣接記事を事前計算
    const adjacentPosts = queryAdjacentPosts(posts, entry.data.slug);
    return {
      params: {
        slug: entry.data.slug,
      },
      props: {
        entry,
        adjacentPosts,
      },
    };
  });
}
type Props = {
  entry: CollectionEntry<'postsV2'>;
  adjacentPosts: {
    prev: CollectionEntry<'postsV2'> | null;
    next: CollectionEntry<'postsV2'> | null;
  };
};
const { entry, adjacentPosts } = Astro.props;
---

<PostDetailPage entry={entry} adjacentPosts={adjacentPosts} />
