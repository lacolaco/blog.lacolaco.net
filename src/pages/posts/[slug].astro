---
import { type CollectionEntry } from 'astro:content';
import PostDetailPage from 'src/layouts/PostDetailPage.astro';
import { queryAvailablePosts, queryAdjacentPosts } from '@lib/query';

export async function getStaticPaths() {
  const posts = await queryAvailablePosts();
  // 日本語記事のみ（英語記事は [slug].en.astro で処理）
  const jaPosts = posts.filter((post) => post.data.locale !== 'en');

  return jaPosts.map((entry) => {
    // ビルド時に隣接記事を事前計算
    const adjacentPosts = queryAdjacentPosts(posts, entry.data.slug);
    return {
      params: {
        slug: entry.data.slug,
      },
      props: {
        entry,
        adjacentPosts,
      },
    };
  });
}
type Props = {
  entry: CollectionEntry<'posts'>;
  adjacentPosts: {
    prev: CollectionEntry<'posts'> | null;
    next: CollectionEntry<'posts'> | null;
  };
};
const { entry, adjacentPosts } = Astro.props;
---

<PostDetailPage entry={entry} adjacentPosts={adjacentPosts} />
