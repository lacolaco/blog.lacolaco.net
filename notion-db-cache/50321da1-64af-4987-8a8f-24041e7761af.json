[{"object":"block","id":"34239929-4ee8-4f66-8e58-0784e92ee978","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T11:45:00.000Z","last_edited_time":"2024-08-27T11:50:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"mizdraさんのブログに触発されて、特定の日時を過ぎるまでは秘匿されなければならないビューをクライアントサイドだけで実装する方法を考えた。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"mizdraさんのブログに触発されて、特定の日時を過ぎるまでは秘匿されなければならないビューをクライアントサイドだけで実装する方法を考えた。","href":null}],"color":"default"}},{"object":"block","id":"3942e239-0101-4713-9e62-74cd08f28152","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T11:46:00.000Z","last_edited_time":"2024-08-27T11:46:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"bookmark","bookmark":{"caption":[],"url":"https://www.mizdra.net/entry/2024/08/27/190853"}},{"object":"block","id":"b253e7a5-b507-4137-9f4b-c849e3b0bb32","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T11:54:00.000Z","last_edited_time":"2024-08-27T11:54:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[],"color":"default"}},{"object":"block","id":"c3c79268-47fb-4abd-bd25-f88384eaee9b","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T11:54:00.000Z","last_edited_time":"2024-08-27T11:55:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"Angularには ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Angularには ","href":null},{"type":"text","text":{"content":"@defer","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@defer","href":null},{"type":"text","text":{"content":" 構文によってチャンク分割したコンポーネントを遅延読み込みする機能があるため、これを使うと似たようなことができるのではと思い、実験してみた。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" 構文によってチャンク分割したコンポーネントを遅延読み込みする機能があるため、これを使うと似たようなことができるのではと思い、実験してみた。","href":null}],"color":"default"}},{"object":"block","id":"cf8cdc6f-4430-41fc-b3b9-109904aa2d9e","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T11:48:00.000Z","last_edited_time":"2024-08-27T11:55:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"実装","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"実装","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"e8046734-89a6-43f2-bdf8-d9b2ec490aaf","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T11:55:00.000Z","last_edited_time":"2024-08-27T11:56:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"まずは秘匿されるコンテンツをひとつのコンポーネントにまとめる。今回は ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"まずは秘匿されるコンテンツをひとつのコンポーネントにまとめる。今回は ","href":null},{"type":"text","text":{"content":"CampaignMessage","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CampaignMessage","href":null},{"type":"text","text":{"content":" とした。このコンポーネントは遅延読み込みされる側なので特別な実装はなにもない。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" とした。このコンポーネントは遅延読み込みされる側なので特別な実装はなにもない。","href":null}],"color":"default"}},{"object":"block","id":"29580301-5a8e-4e1e-ad04-70ec0cb698cc","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T11:56:00.000Z","last_edited_time":"2024-08-27T11:56:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[],"color":"default"}},{"object":"block","id":"20bb053a-20f2-41e7-adf7-38f5a187a1f2","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T11:56:00.000Z","last_edited_time":"2024-08-27T11:57:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"code","code":{"caption":[{"type":"text","text":{"content":"src/campaign.ts","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"src/campaign.ts","href":null}],"rich_text":[{"type":"text","text":{"content":"import { Component } from '@angular/core';\n\n@Component({\n  selector: 'campaign-message',\n  standalone: true,\n  template: `\n  <p>Happy New Year!</p>\n  `,\n})\nexport default class CampaignMessage {}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"import { Component } from '@angular/core';\n\n@Component({\n  selector: 'campaign-message',\n  standalone: true,\n  template: `\n  <p>Happy New Year!</p>\n  `,\n})\nexport default class CampaignMessage {}","href":null}],"language":"typescript"}},{"object":"block","id":"d111c07b-f8aa-4c80-8ff8-f2d8611a70f6","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T11:56:00.000Z","last_edited_time":"2024-09-04T09:48:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"このコンポーネントを遅延読み込みする側でスケジュールを管理する必要がある。 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"このコンポーネントを遅延読み込みする側でスケジュールを管理する必要がある。 ","href":null},{"type":"text","text":{"content":"@defer","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@defer","href":null},{"type":"text","text":{"content":" にはビルトインの ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" にはビルトインの ","href":null},{"type":"text","text":{"content":"on","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"on","href":null},{"type":"text","text":{"content":" トリガーもあるが、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" トリガーもあるが、 ","href":null},{"type":"text","text":{"content":"when","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"when","href":null},{"type":"text","text":{"content":" で任意のトリガーを実装できる。 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" で任意のトリガーを実装できる。 ","href":null},{"type":"text","text":{"content":"when","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"when","href":null},{"type":"text","text":{"content":" トリガーには評価するとブール値が返されるような式を渡せばよく、はじめて評価結果が True になったときに遅延読み込みが開始される。評価結果が False の間は ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" トリガーには評価するとブール値が返されるような式を渡せばよく、はじめて評価結果が True になったときに遅延読み込みが開始される。評価結果が False の間は ","href":null},{"type":"text","text":{"content":"@placeholder","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@placeholder","href":null},{"type":"text","text":{"content":" の内容が表示される。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の内容が表示される。","href":null}],"color":"default"}},{"object":"block","id":"f3ea1d6b-cc33-405e-bfdf-46f1755c6182","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T12:01:00.000Z","last_edited_time":"2024-08-27T12:01:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"bookmark","bookmark":{"caption":[],"url":"https://angular.jp/guide/defer#トリガー"}},{"object":"block","id":"0b8b2af4-17f1-4909-94b4-255f4a923020","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T12:00:00.000Z","last_edited_time":"2024-08-27T12:00:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[],"color":"default"}},{"object":"block","id":"2c100a88-7cd8-406a-beec-04b2f144d3f9","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T12:00:00.000Z","last_edited_time":"2024-08-27T12:10:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"import CampaignMessage from './campaign';\n\n@Component({\n  selector: 'app-root',\n  standalone: true,\n  imports: [CampaignMessage],\n  template: `\n    @defer(when isOpen(\"2024-01-01\")) {\n      <campaign-message />\n    }\n    @placeholder {\n      <p>Stay tuned!</p>\n    }\n  `,\n})\nexport class App {\n  isOpen(shownAt: string) {\n    return new Date() >= new Date(shownAt);\n  }\n}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"import CampaignMessage from './campaign';\n\n@Component({\n  selector: 'app-root',\n  standalone: true,\n  imports: [CampaignMessage],\n  template: `\n    @defer(when isOpen(\"2024-01-01\")) {\n      <campaign-message />\n    }\n    @placeholder {\n      <p>Stay tuned!</p>\n    }\n  `,\n})\nexport class App {\n  isOpen(shownAt: string) {\n    return new Date() >= new Date(shownAt);\n  }\n}","href":null}],"language":"typescript"}},{"object":"block","id":"cfd62574-157e-4480-bc56-f8e86e951715","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T12:02:00.000Z","last_edited_time":"2024-08-27T12:02:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[],"color":"default"}},{"object":"block","id":"fab95d3f-e964-407c-984b-0b3608608746","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T12:04:00.000Z","last_edited_time":"2024-08-27T12:12:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"@defer","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@defer","href":null},{"type":"text","text":{"content":" ブロックによってJavaScriptファイルが分割されているため、トリガーが発火するまでにブラウザからダウンロードされるファイルにはキャンペーン内容は含まれていない。ただし遅延読み込みするコード（実体は結局 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" ブロックによってJavaScriptファイルが分割されているため、トリガーが発火するまでにブラウザからダウンロードされるファイルにはキャンペーン内容は含まれていない。ただし遅延読み込みするコード（実体は結局 ","href":null},{"type":"text","text":{"content":"import()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"import()","href":null},{"type":"text","text":{"content":" ）は含まれているのでそこからファイルパスを引き抜かれたら直接ダウンロードされてしまうリスクはある。今回はその点については諦めた。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" ）は含まれているのでそこからファイルパスを引き抜かれたら直接ダウンロードされてしまうリスクはある。今回はその点については諦めた。","href":null}],"color":"default"}},{"object":"block","id":"88679fb4-487e-47e9-aabc-d8c4a6dae900","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T12:12:00.000Z","last_edited_time":"2024-08-27T12:12:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"もともとの要件では、秘匿される情報はブラウザにダウンロードされるJavaScriptファイルの中に含めてはいけない。サーバーサイドがあるならAPIで返すなりSSRで埋め込むなりやりようはいろいろあるが、これをサーバーサイドなしでやろうとするとどこかで妥協は必要になる。そもそもデバイスの時計をいじられたらアウトだ。なので実用性はあまりないかもしれない。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"もともとの要件では、秘匿される情報はブラウザにダウンロードされるJavaScriptファイルの中に含めてはいけない。サーバーサイドがあるならAPIで返すなりSSRで埋め込むなりやりようはいろいろあるが、これをサーバーサイドなしでやろうとするとどこかで妥協は必要になる。そもそもデバイスの時計をいじられたらアウトだ。なので実用性はあまりないかもしれない。","href":null}],"color":"default"}},{"object":"block","id":"085c9889-dcc6-4952-a4b1-5db3f43202b6","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T12:07:00.000Z","last_edited_time":"2024-08-27T12:08:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"また、あくまでも遅延読み込みされることを前提としており、どこか別の場所で ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"また、あくまでも遅延読み込みされることを前提としており、どこか別の場所で ","href":null},{"type":"text","text":{"content":"campaign.ts","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"campaign.ts","href":null},{"type":"text","text":{"content":" をインポートして中身を静的に参照していたら当然一緒にバンドルされるので意味がない。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" をインポートして中身を静的に参照していたら当然一緒にバンドルされるので意味がない。","href":null}],"color":"default"}},{"object":"block","id":"383b474b-402f-48e5-90a4-69f99925b826","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T12:06:00.000Z","last_edited_time":"2024-08-27T12:09:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"とはいえ ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"とはいえ ","href":null},{"type":"text","text":{"content":"when","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"when","href":null},{"type":"text","text":{"content":" 条件を使う例としておもしろかった。実際に動作するサンプルも置いておく。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" 条件を使う例としておもしろかった。実際に動作するサンプルも置いておく。","href":null}],"color":"default"}},{"object":"block","id":"8051537d-1d54-4c61-b2a4-dfe761f53016","parent":{"type":"page_id","page_id":"50321da1-64af-4987-8a8f-24041e7761af"},"created_time":"2024-08-27T11:48:00.000Z","last_edited_time":"2024-08-27T11:48:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"embed","embed":{"caption":[],"url":"https://stackblitz.com/edit/stackblitz-starters-vrvpn4?ctl=1&embed=1&file=src/main.ts"}}]