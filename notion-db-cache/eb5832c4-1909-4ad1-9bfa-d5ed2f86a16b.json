[{"object":"block","id":"d93ed5a1-7674-4d65-9fd5-9e234081b6e2","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"本稿では ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"本稿では ","href":null},{"type":"text","text":{"content":"Nx","link":{"url":"nx.dev"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Nx","href":"nx.dev"},{"type":"text","text":{"content":" を使ったAngular+Nest.jsのmonorepoアプリケーションを単一のDockerイメージとしてデプロイ可能にする手順を記す。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を使ったAngular+Nest.jsのmonorepoアプリケーションを単一のDockerイメージとしてデプロイ可能にする手順を記す。","href":null}],"color":"default"}},{"object":"block","id":"7e00b1ba-6dcd-4138-9a49-b308f52f90ee","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"サンプルコードの最終的な状態は以下のリポジトリに公開している。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"サンプルコードの最終的な状態は以下のリポジトリに公開している。","href":null}],"color":"default"}},{"object":"block","id":"29eaf552-a615-4180-9fe4-0d6ef79914b7","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T02:19:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"https://github.com/lacolaco/nx-angular-nest-docker-example","link":{"url":"https://github.com/lacolaco/nx-angular-nest-docker-example"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"https://github.com/lacolaco/nx-angular-nest-docker-example","href":"https://github.com/lacolaco/nx-angular-nest-docker-example"}],"color":"default"}},{"object":"block","id":"c6fb1f34-3eff-4363-9f57-2f957f5ec0c2","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"0. 背景","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"0. 背景","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"56d1c5c7-be77-4a9c-beb8-c49881dec4f9","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"一般的にはSingle Page Applicationのクライアントとサーバーは別のコンテナとしてデプロイされNginxなどで静的ファイルへのリクエストとAPIリクエストを振り分けることが多いが、今回はあえて単一のDockerコンテナでHTTPサーバーを立ち上げ、そのサーバーから静的ファイルとしてクライアントをサーブする。 なぜかというと、今回は","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"一般的にはSingle Page Applicationのクライアントとサーバーは別のコンテナとしてデプロイされNginxなどで静的ファイルへのリクエストとAPIリクエストを振り分けることが多いが、今回はあえて単一のDockerコンテナでHTTPサーバーを立ち上げ、そのサーバーから静的ファイルとしてクライアントをサーブする。 なぜかというと、今回は","href":null},{"type":"text","text":{"content":"Google Cloud Run","link":{"url":"https://cloud.google.com/run?hl=ja"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Google Cloud Run","href":"https://cloud.google.com/run?hl=ja"},{"type":"text","text":{"content":"にアプリケーションをデプロイすることが目的だからだ。Cloud Runには単一のDockerfileからビルドされるイメージをデプロイできる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"にアプリケーションをデプロイすることが目的だからだ。Cloud Runには単一のDockerfileからビルドされるイメージをデプロイできる。","href":null}],"color":"default"}},{"object":"block","id":"f6347585-e0bf-4313-9fec-4909315cf583","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"利点としては、まず環境がCloud Runだけで完結すること。そしてクライアントとサーバーあわせたEnd-to-Endの整合性がとりやすいことがある。 欠点としては個別にデプロイできないことや静的ファイルに特化した配信戦略を取りにくいことだ。ただしCloud RunはFirebase Hostingと連携することでGoogleのCDN網を利用できるため、静的ファイルに適切なレスポンスヘッダをつければFirebase Hostingと同じCDNでのキャッシュが機能する。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"利点としては、まず環境がCloud Runだけで完結すること。そしてクライアントとサーバーあわせたEnd-to-Endの整合性がとりやすいことがある。 欠点としては個別にデプロイできないことや静的ファイルに特化した配信戦略を取りにくいことだ。ただしCloud RunはFirebase Hostingと連携することでGoogleのCDN網を利用できるため、静的ファイルに適切なレスポンスヘッダをつければFirebase Hostingと同じCDNでのキャッシュが機能する。","href":null}],"color":"default"}},{"object":"block","id":"889be8f8-bd76-4470-8375-ab5ab53c73c1","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"1. workspaceの作成","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"1. workspaceの作成","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"454717ce-c898-4338-84f5-d4fc9d8e7288","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"まずはNxのworkspaceを作成する。 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"まずはNxのworkspaceを作成する。 ","href":null},{"type":"text","text":{"content":"create-nx-workspace","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"create-nx-workspace","href":null},{"type":"text","text":{"content":" コマンドを使い、今回は ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" コマンドを使い、今回は ","href":null},{"type":"text","text":{"content":"angular-nest","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"angular-nest","href":null},{"type":"text","text":{"content":" を選択するが、本稿の趣旨においては別に ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を選択するが、本稿の趣旨においては別に ","href":null},{"type":"text","text":{"content":"react-express","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"react-express","href":null},{"type":"text","text":{"content":" でも違いはない。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" でも違いはない。","href":null}],"color":"default"}},{"object":"block","id":"14d338d8-e6da-47b4-a78a-c342cc8505eb","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"$ npx create-nx-workspace@latest angular-nest-docker-example`","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"$ npx create-nx-workspace@latest angular-nest-docker-example`","href":null}],"language":"plain text"}},{"object":"block","id":"0b3670eb-3588-4927-9b52-4dd5494cf04d","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"2. outputPathの変更 (client, server)","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"2. outputPathの変更 (client, server)","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"14f72095-3afb-4862-b055-a6c7cd3fa37e","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"angular-nest","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"angular-nest","href":null},{"type":"text","text":{"content":" テンプレートのデフォルトで生成されるプロジェクトは、クライアントサイドが ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" テンプレートのデフォルトで生成されるプロジェクトは、クライアントサイドが ","href":null},{"type":"text","text":{"content":"<application-name>","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"<application-name>","href":null},{"type":"text","text":{"content":" 、サーバーサイドが ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" 、サーバーサイドが ","href":null},{"type":"text","text":{"content":"api","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"api","href":null},{"type":"text","text":{"content":" となっている。これをそれぞれ ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" となっている。これをそれぞれ ","href":null},{"type":"text","text":{"content":"dist/apps/client","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"dist/apps/client","href":null},{"type":"text","text":{"content":" と ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" と ","href":null},{"type":"text","text":{"content":"dist/apps/server","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"dist/apps/server","href":null},{"type":"text","text":{"content":" にビルド結果が出力されるようにする。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" にビルド結果が出力されるようにする。","href":null}],"color":"default"}},{"object":"block","id":"37d1c801-66c7-4b6f-960c-faadb3618384","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"external","external":{"url":"https://img.esa.io/uploads/production/attachments/14362/2020/04/29/50720/b4788f7b-46f4-4f81-a245-2e21d073a9ef.png"}}},{"object":"block","id":"96af00fb-e637-46d1-b4b9-db0dd0fd9704","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"external","external":{"url":"https://img.esa.io/uploads/production/attachments/14362/2020/04/29/50720/ab9b76d1-9c44-4046-b035-14ff8552e70d.png"}}},{"object":"block","id":"799bf113-be40-4bf7-a65c-a5dda966dc0b","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"3. ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"3. ","href":null},{"type":"text","text":{"content":"@nestjs/serve-static","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@nestjs/serve-static","href":null},{"type":"text","text":{"content":" の追加 (server)","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の追加 (server)","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"00f18f3c-ca8e-4679-a18c-e6a6fd483387","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"クライアントサイドをビルドした生成物をNest.jsがサーブできるように、静的ファイル配信用のモジュールを追加する。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"クライアントサイドをビルドした生成物をNest.jsがサーブできるように、静的ファイル配信用のモジュールを追加する。","href":null}],"color":"default"}},{"object":"block","id":"47afed2c-8cab-427d-8201-c9226fe77778","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"$ yarn add @nestjs/serve-static`","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"$ yarn add @nestjs/serve-static`","href":null}],"language":"plain text"}},{"object":"block","id":"c3f981d4-95cc-4132-9fe9-60ec3150ca6d","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"静的ファイルはさきほど変更したoutputPathのとおり、clientとserverが隣接するディレクトリになるため、ルートディレクトリには ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"静的ファイルはさきほど変更したoutputPathのとおり、clientとserverが隣接するディレクトリになるため、ルートディレクトリには ","href":null},{"type":"text","text":{"content":"../client","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"../client","href":null},{"type":"text","text":{"content":" を指定する。 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を指定する。 ","href":null},{"type":"text","text":{"content":"/api*","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"/api*","href":null},{"type":"text","text":{"content":" はAPIのエンドポイントにマッチするように除外しておく。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" はAPIのエンドポイントにマッチするように除外しておく。","href":null}],"color":"default"}},{"object":"block","id":"037052af-66ab-4cf2-a7c7-70002c0d6a94","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T02:19:00.000Z","last_edited_time":"2023-05-21T02:19:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"import { Module } from '@nestjs/common';\nimport { ServeStaticModule } from '@nestjs/serve-static';\nimport * as path from 'path';\n\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\n\n@Module({\n  imports: [\n    ServeStaticModule.forRoot({\n      rootPath: path.join(__dirname, '..', 'client'),\n      exclude: ['/api*']\n    })\n  ],\n  controllers: [AppController],\n  providers: [AppService]\n})\nexport class AppModule {}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"import { Module } from '@nestjs/common';\nimport { ServeStaticModule } from '@nestjs/serve-static';\nimport * as path from 'path';\n\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\n\n@Module({\n  imports: [\n    ServeStaticModule.forRoot({\n      rootPath: path.join(__dirname, '..', 'client'),\n      exclude: ['/api*']\n    })\n  ],\n  controllers: [AppController],\n  providers: [AppService]\n})\nexport class AppModule {}","href":null}],"language":"plain text"}},{"object":"block","id":"cb8dd4f6-33be-4ecf-ada7-c2a49235da22","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"加えて、APIのエンドポイントが ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"加えて、APIのエンドポイントが ","href":null},{"type":"text","text":{"content":"/api/hello","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"/api/hello","href":null},{"type":"text","text":{"content":" となるように ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" となるように ","href":null},{"type":"text","text":{"content":"main.ts","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"main.ts","href":null},{"type":"text","text":{"content":" と ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" と ","href":null},{"type":"text","text":{"content":"app.controller.ts","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"app.controller.ts","href":null},{"type":"text","text":{"content":" も微修正する。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" も微修正する。","href":null}],"color":"default"}},{"object":"block","id":"f415b2cb-a033-4926-88b5-3345bf208ffc","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"external","external":{"url":"https://img.esa.io/uploads/production/attachments/14362/2020/04/29/50720/14911365-d4a5-45d3-a2fb-db9cb9af9aa3.png"}}},{"object":"block","id":"39476491-860c-4aaf-8610-8a9c09a242ff","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"external","external":{"url":"https://img.esa.io/uploads/production/attachments/14362/2020/04/29/50720/551cf696-a389-4509-adde-96b69baa6435.png"}}},{"object":"block","id":"a9df4ae8-cec1-470f-b970-a073ca795cf5","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"5. プロジェクト間依存関係の設定","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"5. プロジェクト間依存関係の設定","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"fb881267-f583-470b-8ded-e511d1d5ec2b","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"サーバーサイドがクライアントサイドのビルド生成物を配信するということは、サーバーサイドからクライアントサイドへのビルド順番の依存関係があるということだ。このプロジェクト間の依存関係は ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"サーバーサイドがクライアントサイドのビルド生成物を配信するということは、サーバーサイドからクライアントサイドへのビルド順番の依存関係があるということだ。このプロジェクト間の依存関係は ","href":null},{"type":"text","text":{"content":"nx.json","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"nx.json","href":null},{"type":"text","text":{"content":" で定義できる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" で定義できる。","href":null}],"color":"default"}},{"object":"block","id":"296b0457-5aea-426b-9de5-7b827cdd8228","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"external","external":{"url":"https://img.esa.io/uploads/production/attachments/14362/2020/04/29/50720/4089b50f-d651-47f3-9a43-7888c00ef520.png"}}},{"object":"block","id":"62a2dc2e-bd66-4d8b-bfec-c2205fa163d6","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"nx dep-graph","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"nx dep-graph","href":null},{"type":"text","text":{"content":" コマンドで依存関係を可視化すると以下のようになる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" コマンドで依存関係を可視化すると以下のようになる。","href":null}],"color":"default"}},{"object":"block","id":"5b291ff1-3792-463d-a770-0af0116a2577","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"external","external":{"url":"https://img.esa.io/uploads/production/attachments/14362/2020/04/29/50720/db993e3d-b3ac-4ee2-bb8e-fa01c2fb064f.png"}}},{"object":"block","id":"f46a4067-4b8d-4901-9be9-869ca15f67a4","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"この状態になっていると、サーバーサイドをビルドする際に自動的にクライアントサイドのビルドを先に実行することができる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"この状態になっていると、サーバーサイドをビルドする際に自動的にクライアントサイドのビルドを先に実行することができる。","href":null}],"color":"default"}},{"object":"block","id":"915ccfa4-ad8f-450f-9a37-de7be7c70ebf","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"$ nx build api --with-deps","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"$ nx build api --with-deps","href":null}],"language":"plain text"}},{"object":"block","id":"97e4e08d-43ec-4ff4-bda7-259ed5a7eb25","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"external","external":{"url":"https://img.esa.io/uploads/production/attachments/14362/2020/04/29/50720/a63eddd9-ca08-4b8b-af13-1aa8029bd80a.png"}}},{"object":"block","id":"63cacdfe-e486-49d1-aac5-3e0e4f855f25","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"これでmonorepo内の依存関係を解決した上で ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"これでmonorepo内の依存関係を解決した上で ","href":null},{"type":"text","text":{"content":"dist","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"dist","href":null},{"type":"text","text":{"content":" ディレクトリに生成物を出力できるようになった。ためしに ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" ディレクトリに生成物を出力できるようになった。ためしに ","href":null},{"type":"text","text":{"content":"dist/apps/server/main.js","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"dist/apps/server/main.js","href":null},{"type":"text","text":{"content":" を実行すれば、AngularアプリケーションがNest.jsのAPIを実行するアプリケーションが起動できる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を実行すれば、AngularアプリケーションがNest.jsのAPIを実行するアプリケーションが起動できる。","href":null}],"color":"default"}},{"object":"block","id":"a8bfcec0-f085-4588-9aed-835b7a307008","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"6. Dockerfileの作成","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"6. Dockerfileの作成","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"b8c3c253-61ce-4f3b-97df-a179ca53e665","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"Dockerfileを作ってデプロイ可能なイメージをビルドするが、その前にいくつか準備が必要になる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Dockerfileを作ってデプロイ可能なイメージをビルドするが、その前にいくつか準備が必要になる。","href":null}],"color":"default"}},{"object":"block","id":"46fd3830-8104-471e-8b77-8cc8f88c2c37","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"まず、今のバージョン（Nx v9.2.3）の ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"まず、今のバージョン（Nx v9.2.3）の ","href":null},{"type":"text","text":{"content":"angular-nest","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"angular-nest","href":null},{"type":"text","text":{"content":" で生成される ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" で生成される ","href":null},{"type":"text","text":{"content":"package.json","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"package.json","href":null},{"type":"text","text":{"content":" から、","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" から、","href":null},{"type":"text","text":{"content":"postinstall","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"postinstall","href":null},{"type":"text","text":{"content":" の ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の ","href":null},{"type":"text","text":{"content":"ngcc","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"ngcc","href":null},{"type":"text","text":{"content":" の実行スクリプトを削除する。これがあるとDockerfile内でモジュールをインストールしたときに不要な処理が実行される。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の実行スクリプトを削除する。これがあるとDockerfile内でモジュールをインストールしたときに不要な処理が実行される。","href":null}],"color":"default"}},{"object":"block","id":"d6b67766-26a8-4839-88a6-459e29c5f537","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"external","external":{"url":"https://img.esa.io/uploads/production/attachments/14362/2020/04/29/50720/e16b8950-ff65-4705-982f-124bb24fe7eb.png"}}},{"object":"block","id":"bf6be92a-644e-4015-8003-137b8a1f3890","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"次に、サーバーの ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"次に、サーバーの ","href":null},{"type":"text","text":{"content":"main.ts","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"main.ts","href":null},{"type":"text","text":{"content":" が使用する環境変数を ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" が使用する環境変数を ","href":null},{"type":"text","text":{"content":"port","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"port","href":null},{"type":"text","text":{"content":" から ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" から ","href":null},{"type":"text","text":{"content":"PORT","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"PORT","href":null},{"type":"text","text":{"content":" に変更する。どちらでもよいが一般的に大文字のほうを使うため変更した。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" に変更する。どちらでもよいが一般的に大文字のほうを使うため変更した。","href":null}],"color":"default"}},{"object":"block","id":"09d7e4c5-1f22-44df-a7fa-054ea1683a3b","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"external","external":{"url":"https://img.esa.io/uploads/production/attachments/14362/2020/04/29/50720/907fd1e3-f772-4575-bf11-4a5a68b20930.png"}}},{"object":"block","id":"afbd82bc-07cf-4f48-a7f3-ca286fbffa26","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"そしてDockerfileは次のような形にした。Nxのビルドはサーバーサイドもバンドルするため、本当はDockerfileでは ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"そしてDockerfileは次のような形にした。Nxのビルドはサーバーサイドもバンドルするため、本当はDockerfileでは ","href":null},{"type":"text","text":{"content":"node_modules","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"node_modules","href":null},{"type":"text","text":{"content":" のインストールをしたくないのだが、Nest.jsが ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" のインストールをしたくないのだが、Nest.jsが ","href":null},{"type":"text","text":{"content":"tslib","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"tslib","href":null},{"type":"text","text":{"content":" が見つからずエラーになってしまうため仕方なくインストールしている。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" が見つからずエラーになってしまうため仕方なくインストールしている。","href":null}],"color":"default"}},{"object":"block","id":"01031b81-526e-4fb1-98e4-0f1541c6c0e9","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"FROM node:12WORKDIR /appCOPY package.json yarn.lock ./RUN yarn install --production# add appCOPY ./dist/ ./# start appCMD node apps/server/main.js","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"FROM node:12WORKDIR /appCOPY package.json yarn.lock ./RUN yarn install --production# add appCOPY ./dist/ ./# start appCMD node apps/server/main.js","href":null}],"language":"plain text"}},{"object":"block","id":"cefbcecd-19c3-4aac-86b1-50947b02aecc","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"あとは ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"あとは ","href":null},{"type":"text","text":{"content":"docker build .","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"docker build .","href":null},{"type":"text","text":{"content":" でビルドし、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" でビルドし、 ","href":null},{"type":"text","text":{"content":"docker run","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"docker run","href":null},{"type":"text","text":{"content":" コマンドで実行できることを確認する。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" コマンドで実行できることを確認する。","href":null}],"color":"default"}},{"object":"block","id":"948e9b66-a119-4650-824d-900fd99f31ec","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"external","external":{"url":"https://img.esa.io/uploads/production/attachments/14362/2020/04/29/50720/94340e50-27ee-4c6f-9dd8-96697ae808db.png"}}},{"object":"block","id":"7fbe17ca-33b7-4b5c-aaca-6ee3438776d2","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"これでCloud Runにデプロイ可能な状態となった。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"これでCloud Runにデプロイ可能な状態となった。","href":null}],"color":"default"}},{"object":"block","id":"0a07edfe-00d8-4de0-8cc3-a65dc8e39042","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"課題","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"課題","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"4497de16-1e55-4e5c-9a76-84bc0249cdaa","parent":{"type":"page_id","page_id":"eb5832c4-1909-4ad1-9bfa-d5ed2f86a16b"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":true,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"Dockerfileで node_modulesをインストールするなら、最初からNest.jsのビルドでバンドルをしないようにしたほうがイメージサイズが減るのではないか","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Dockerfileで node_modulesをインストールするなら、最初からNest.jsのビルドでバンドルをしないようにしたほうがイメージサイズが減るのではないか","href":null}],"color":"default"},"children":[{"object":"block","id":"e1483088-36db-4973-864e-fe3549ff69c0","parent":{"type":"block_id","block_id":"4497de16-1e55-4e5c-9a76-84bc0249cdaa"},"created_time":"2023-05-21T00:22:00.000Z","last_edited_time":"2023-05-21T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"Nest.jsである必要もないので面倒そうならexpressに換装してもよさそう","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Nest.jsである必要もないので面倒そうならexpressに換装してもよさそう","href":null}],"color":"default"}}]}]