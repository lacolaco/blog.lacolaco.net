[{"object":"block","id":"b6637578-3409-4fde-907d-acd2e9754a05","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:36:00.000Z","last_edited_time":"2023-02-08T11:35:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"いまさらだが、秘密鍵を共有する方法ではなく、GitHub Actions のOIDCトークンを使った方法を使ってGCPの認証を有効にしてみたので、その作業メモ。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"いまさらだが、秘密鍵を共有する方法ではなく、GitHub Actions のOIDCトークンを使った方法を使ってGCPの認証を有効にしてみたので、その作業メモ。","href":null}],"color":"default"}},{"object":"block","id":"e3d62d5a-1da5-4f15-bcae-cf7268fc1e5e","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2023-02-08T11:29:00.000Z","last_edited_time":"2023-02-08T11:29:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[],"color":"default"}},{"object":"block","id":"b9e139bd-eda6-4b43-b973-ca1a842a104f","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:41:00.000Z","last_edited_time":"2022-07-30T12:41:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bookmark","bookmark":{"caption":[],"url":"https://github.blog/changelog/2021-10-27-github-actions-secure-cloud-deployments-with-openid-connect/"}},{"object":"block","id":"e02d7aba-8cca-4046-9966-b09e11112a7a","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:36:00.000Z","last_edited_time":"2022-07-30T12:36:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bookmark","bookmark":{"caption":[],"url":"https://cloud.google.com/blog/ja/products/identity-security/enabling-keyless-authentication-from-github-actions"}},{"object":"block","id":"075c4483-ee14-4a3e-af97-f8533d6def64","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:38:00.000Z","last_edited_time":"2022-07-30T12:43:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"基本的には Google Cloud Blog に書いてあるとおりのことをやっただけだが、ほとんどのドキュメントが ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"基本的には Google Cloud Blog に書いてあるとおりのことをやっただけだが、ほとんどのドキュメントが ","href":null},{"type":"text","text":{"content":"gcloud","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"gcloud","href":null},{"type":"text","text":{"content":" コマンドを使った設定手順しか説明していないので、あえてWebコンソール上で同等の操作を読み解いて作業した。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" コマンドを使った設定手順しか説明していないので、あえてWebコンソール上で同等の操作を読み解いて作業した。","href":null}],"color":"default"}},{"object":"block","id":"4ced661c-0d7c-4a32-8e39-d949d6ada9c0","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:43:00.000Z","last_edited_time":"2022-07-30T12:44:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"GCP: Workload Identity プロバイダの作成","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"GCP: Workload Identity プロバイダの作成","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"52e2bf8a-ffb2-4b90-a23f-4f3e1f955bf7","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:44:00.000Z","last_edited_time":"2022-07-30T12:47:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"下の図でいうところの ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"下の図でいうところの ","href":null},{"type":"text","text":{"content":"Cloud Provider","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"Cloud Provider","href":null},{"type":"text","text":{"content":" を準備する。GCPではこの部分が ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を準備する。GCPではこの部分が ","href":null},{"type":"text","text":{"content":"IDプロバイダ","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"IDプロバイダ","href":null},{"type":"text","text":{"content":" と、それのコンテナになる ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" と、それのコンテナになる ","href":null},{"type":"text","text":{"content":"Workload Identity プール","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Workload Identity プール","href":null},{"type":"text","text":{"content":" という2つのリソースからなる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" という2つのリソースからなる。","href":null}],"color":"default"}},{"object":"block","id":"6d2a4a9f-1ffc-440f-9596-00f3107e3f69","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:44:00.000Z","last_edited_time":"2022-07-30T12:44:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"file","file":{"url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/3c6255ea-b6c7-4055-8126-638d2819f0c3/bd584724-f6ec-4447-9962-b077ad4da1d5/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240122%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240122T130733Z&X-Amz-Expires=3600&X-Amz-Signature=f9280c8a26fac540ea6fc73afffd0b8faeeb8e8fadd1646174d2cd69389b31f3&X-Amz-SignedHeaders=host&x-id=GetObject","expiry_time":"2024-01-22T14:07:33.005Z"}}},{"object":"block","id":"24f1a6c4-d67b-4fa5-a79c-b7a458e3eeee","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:46:00.000Z","last_edited_time":"2022-07-30T13:06:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"手順は4つある。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"手順は4つある。","href":null}],"color":"default"}},{"object":"block","id":"6fa75580-5b32-4c49-8198-8c6febf57432","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:47:00.000Z","last_edited_time":"2022-07-30T13:30:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"numbered_list_item","numbered_list_item":{"rich_text":[{"type":"text","text":{"content":"Workload Identity プール","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Workload Identity プール","href":null},{"type":"text","text":{"content":"を作成する","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"を作成する","href":null}],"color":"default"}},{"object":"block","id":"65b97d33-ecc8-4750-b9c6-6fb474e6cbd7","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:47:00.000Z","last_edited_time":"2022-07-30T13:30:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"numbered_list_item","numbered_list_item":{"rich_text":[{"type":"text","text":{"content":"プールに ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"プールに ","href":null},{"type":"text","text":{"content":"IDプロバイダ","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"IDプロバイダ","href":null},{"type":"text","text":{"content":" を追加する","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を追加する","href":null}],"color":"default"}},{"object":"block","id":"421b4504-5e9f-4b2b-a435-459d8a5f87d2","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:48:00.000Z","last_edited_time":"2022-07-30T13:30:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"numbered_list_item","numbered_list_item":{"rich_text":[{"type":"text","text":{"content":"IDプロバイダ と GitHub Actions の OIDCトークンとの","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"IDプロバイダ と GitHub Actions の OIDCトークンとの","href":null},{"type":"text","text":{"content":"属性マッピング","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"属性マッピング","href":null},{"type":"text","text":{"content":"を構成する","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"を構成する","href":null}],"color":"default"}},{"object":"block","id":"d1286001-5850-470c-ad35-6690af41051b","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:06:00.000Z","last_edited_time":"2022-07-30T13:30:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"numbered_list_item","numbered_list_item":{"rich_text":[{"type":"text","text":{"content":"属性条件","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"属性条件","href":null},{"type":"text","text":{"content":"を設定する","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"を設定する","href":null}],"color":"default"}},{"object":"block","id":"cfc28437-30c9-40a1-a401-1a29d3324b2b","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:48:00.000Z","last_edited_time":"2022-07-30T12:50:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"まず向かう画面は “IAMと管理” のあたりにあるだろう “Workload Identity 連携” というメニュー。「使ってみる」を押すと最初の Workload Identityプール作成が始まる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"まず向かう画面は “IAMと管理” のあたりにあるだろう “Workload Identity 連携” というメニュー。「使ってみる」を押すと最初の Workload Identityプール作成が始まる。","href":null}],"color":"default"}},{"object":"block","id":"d8a7804d-f727-40be-8dce-035d80803632","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:46:00.000Z","last_edited_time":"2022-07-30T12:46:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[],"color":"default"}},{"object":"block","id":"fce3adb4-4ede-4be2-b2af-1405da3ad3a6","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:46:00.000Z","last_edited_time":"2022-07-30T12:46:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"file","file":{"url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/3c6255ea-b6c7-4055-8126-638d2819f0c3/d39aa217-a01f-4c2b-8a7b-7614b40034b1/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240122%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240122T130733Z&X-Amz-Expires=3600&X-Amz-Signature=5b0af682966b35624562fd7ac813df3d5ba29f1f3ca3541e6f0ab5f5b2fd82e4&X-Amz-SignedHeaders=host&x-id=GetObject","expiry_time":"2024-01-22T14:07:33.015Z"}}},{"object":"block","id":"f24dbaf4-22e6-4b37-a3e7-7e20fef3bf67","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:50:00.000Z","last_edited_time":"2022-07-30T12:52:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_3","heading_3":{"rich_text":[{"type":"text","text":{"content":"Workload Identity プールを作成する","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Workload Identity プールを作成する","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"36870e4b-174c-4d37-aa0d-6de74a5f3424","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:50:00.000Z","last_edited_time":"2022-07-30T12:51:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":true,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"名前を決める","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"名前を決める","href":null}],"color":"default"},"children":[{"object":"block","id":"98bb1812-40a3-4b30-aa88-df7e49e0b75d","parent":{"type":"block_id","block_id":"36870e4b-174c-4d37-aa0d-6de74a5f3424"},"created_time":"2022-07-30T12:50:00.000Z","last_edited_time":"2022-07-30T12:51:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"たぶんグローバルで一意？名前が十分にユニークならIDと同じになるが、そうでない場合はIDを別に指定することになる","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"たぶんグローバルで一意？名前が十分にユニークならIDと同じになるが、そうでない場合はIDを別に指定することになる","href":null}],"color":"default"}}]},{"object":"block","id":"cfafe011-25d4-4e9a-85af-fe4268fbbf72","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:51:00.000Z","last_edited_time":"2022-07-30T12:52:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"説明は任意で、続行する。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"説明は任意で、続行する。","href":null}],"color":"default"}},{"object":"block","id":"71de1195-c1ca-4dc5-afba-dab817cad6ea","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:50:00.000Z","last_edited_time":"2022-07-30T12:50:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"file","file":{"url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/3c6255ea-b6c7-4055-8126-638d2819f0c3/5812de6b-2cc9-4049-b85e-b4561c0a4234/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240122%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240122T130733Z&X-Amz-Expires=3600&X-Amz-Signature=bab324b03dbb3503c009903eb0d7071ba1dce99616d34330efee42a2fdce2a35&X-Amz-SignedHeaders=host&x-id=GetObject","expiry_time":"2024-01-22T14:07:33.014Z"}}},{"object":"block","id":"fd43d484-ae16-45a3-95a8-bff4a3d05dac","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:52:00.000Z","last_edited_time":"2022-07-30T12:52:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_3","heading_3":{"rich_text":[{"type":"text","text":{"content":"IDプロバイダを追加する","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"IDプロバイダを追加する","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"af7fbe19-3447-4e46-ac03-9e2f2b30beb3","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:52:00.000Z","last_edited_time":"2022-07-30T12:54:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"プロバイダは ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"プロバイダは ","href":null},{"type":"text","text":{"content":"OIDC","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"OIDC","href":null}],"color":"default"}},{"object":"block","id":"b630fade-eda4-4e7d-94dc-b21e643f3c91","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:52:00.000Z","last_edited_time":"2022-07-30T12:53:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":true,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"プロバイダの名前を決める","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"プロバイダの名前を決める","href":null}],"color":"default"},"children":[{"object":"block","id":"25355a5d-c4c8-41a8-9846-615d06f33f4a","parent":{"type":"block_id","block_id":"b630fade-eda4-4e7d-94dc-b21e643f3c91"},"created_time":"2022-07-30T12:53:00.000Z","last_edited_time":"2022-07-30T12:53:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"これもたぶんグローバルで一意？","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"これもたぶんグローバルで一意？","href":null}],"color":"default"}}]},{"object":"block","id":"30505f51-d70d-4856-9f20-b9c3916a8b51","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:53:00.000Z","last_edited_time":"2022-07-30T12:57:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":true,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"発行元 (issuer）を指定する","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"発行元 (issuer）を指定する","href":null}],"color":"default"},"children":[{"object":"block","id":"4981b28c-f837-4346-bbd9-a03433a16c9c","parent":{"type":"block_id","block_id":"30505f51-d70d-4856-9f20-b9c3916a8b51"},"created_time":"2022-07-30T12:54:00.000Z","last_edited_time":"2022-07-30T12:57:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"このプロバイダに送られるJWTの発行元。GitHub Actions を示す識別子なのでプロジェクトによらず固定","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"このプロバイダに送られるJWTの発行元。GitHub Actions を示す識別子なのでプロジェクトによらず固定","href":null}],"color":"default"}},{"object":"block","id":"c81880d7-ef5a-43f9-9357-3c344ad41bdb","parent":{"type":"block_id","block_id":"30505f51-d70d-4856-9f20-b9c3916a8b51"},"created_time":"2022-07-30T12:56:00.000Z","last_edited_time":"2022-07-30T12:56:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"","href":null},{"type":"text","text":{"content":"https://token.actions.githubusercontent.com","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"https://token.actions.githubusercontent.com","href":null}],"color":"default"}}]},{"object":"block","id":"5d9db02d-d04d-4ff5-94e2-789c316c9632","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:57:00.000Z","last_edited_time":"2022-07-30T12:58:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"オーディエンスはたぶんデフォルトのままでいい","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"オーディエンスはたぶんデフォルトのままでいい","href":null}],"color":"default"}},{"object":"block","id":"af560663-2eff-4e8d-8ce0-7656e748ad1a","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:52:00.000Z","last_edited_time":"2022-07-30T12:52:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"file","file":{"url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/3c6255ea-b6c7-4055-8126-638d2819f0c3/1fd23d3a-98bf-4102-8404-14e46403aab9/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240122%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240122T130733Z&X-Amz-Expires=3600&X-Amz-Signature=881b53ea0791b9ab9bfb2bddb5508555656fa1afa470781247b087a2e6c6ee9d&X-Amz-SignedHeaders=host&x-id=GetObject","expiry_time":"2024-01-22T14:07:33.019Z"}}},{"object":"block","id":"d4aca2a1-73f8-4f51-8369-2357e1a70101","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:52:00.000Z","last_edited_time":"2022-07-30T13:31:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_3","heading_3":{"rich_text":[{"type":"text","text":{"content":"属性マッピングを構成する","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"属性マッピングを構成する","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"63cf7a21-de60-45ac-b028-b008843a9de7","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:59:00.000Z","last_edited_time":"2022-07-30T13:02:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"GitHub Actionsから送られてきたJWTのフィールドをIDプロバイダが定義する属性にマッピングする。左側がIDプロバイダの属性で、右側がGitHub ActionsのJWTのフィールド。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"GitHub Actionsから送られてきたJWTのフィールドをIDプロバイダが定義する属性にマッピングする。左側がIDプロバイダの属性で、右側がGitHub ActionsのJWTのフィールド。","href":null}],"color":"default"}},{"object":"block","id":"031e00e8-bc3c-4711-b93d-e1f08fdcfe81","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T12:59:00.000Z","last_edited_time":"2022-07-30T13:04:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"file","file":{"url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/3c6255ea-b6c7-4055-8126-638d2819f0c3/e13135aa-8a3a-4a50-a464-08baf927afab/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240122%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240122T130733Z&X-Amz-Expires=3600&X-Amz-Signature=b0b52cccdb1917f65c84d5e84f49e849f13076835eb2751d7eb556c261ccdc3d&X-Amz-SignedHeaders=host&x-id=GetObject","expiry_time":"2024-01-22T14:07:33.022Z"}}},{"object":"block","id":"67ee83dc-6ba5-482f-8742-fe2619c5e6b3","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:00:00.000Z","last_edited_time":"2022-07-30T13:01:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"マッピングが必須なのはおそらく ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"マッピングが必須なのはおそらく ","href":null},{"type":"text","text":{"content":"google.subject","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"google.subject","href":null},{"type":"text","text":{"content":" に対する ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" に対する ","href":null},{"type":"text","text":{"content":"assertion.sub","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"assertion.sub","href":null},{"type":"text","text":{"content":" をマッピングだけ。残りは属性の条件によってトークン発行を制御するために必要なものを任意に選ぶのでいいはず。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" をマッピングだけ。残りは属性の条件によってトークン発行を制御するために必要なものを任意に選ぶのでいいはず。","href":null}],"color":"default"}},{"object":"block","id":"5478af01-beb2-4b09-af70-5b40edda1348","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:03:00.000Z","last_edited_time":"2022-07-30T13:06:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"GitHub ActionsのJWTが含んでいるフィールドはここに説明されている。とりあえず重要なのはワークフローを実行したGitHubユーザーのIDが入る ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"GitHub ActionsのJWTが含んでいるフィールドはここに説明されている。とりあえず重要なのはワークフローを実行したGitHubユーザーのIDが入る ","href":null},{"type":"text","text":{"content":"actor","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"actor","href":null},{"type":"text","text":{"content":" や、ワークフローが実行されたレポジトリ名が入る ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" や、ワークフローが実行されたレポジトリ名が入る ","href":null},{"type":"text","text":{"content":"repository","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"repository","href":null},{"type":"text","text":{"content":" などだろうか。ここはプロジェクトのセキュリティ要求によってIDプロバイダに渡さなければならないものが変わるはず。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" などだろうか。ここはプロジェクトのセキュリティ要求によってIDプロバイダに渡さなければならないものが変わるはず。","href":null}],"color":"default"}},{"object":"block","id":"ef743089-91ae-4a5a-a211-09df5de2317d","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:50:00.000Z","last_edited_time":"2022-07-30T13:50:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect","link":{"url":"https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect","href":"https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect"}],"color":"default"}},{"object":"block","id":"49fe840a-853f-4828-b132-6ee573de7889","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:04:00.000Z","last_edited_time":"2022-07-30T13:07:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_3","heading_3":{"rich_text":[{"type":"text","text":{"content":"属性条件を設定する","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"属性条件を設定する","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"b8a1b268-064d-48f1-94a1-914e24db39f9","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:07:00.000Z","last_edited_time":"2022-07-30T13:09:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"属性マッピングができたら、属性条件を設定してトークン発行できるリクエスト元を制限する。今回は自分しか触らないレポジトリでの認証なので、「ワークフローの実行者が ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"属性マッピングができたら、属性条件を設定してトークン発行できるリクエスト元を制限する。今回は自分しか触らないレポジトリでの認証なので、「ワークフローの実行者が ","href":null},{"type":"text","text":{"content":"lacolaco","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"lacolaco","href":null},{"type":"text","text":{"content":" である」という条件を書いた。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" である」という条件を書いた。","href":null}],"color":"default"}},{"object":"block","id":"81aad913-77ba-4fa6-bc63-1c57dedb324d","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-31T01:58:00.000Z","last_edited_time":"2022-07-31T01:58:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"file","file":{"url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/3c6255ea-b6c7-4055-8126-638d2819f0c3/fa85c010-c61b-4929-b208-41cbd68a0225/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240122%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240122T130733Z&X-Amz-Expires=3600&X-Amz-Signature=a6af80680c3aaf96c4e2fc5251ef6ce18cb61c572472bb7435ad564a69b38dbf&X-Amz-SignedHeaders=host&x-id=GetObject","expiry_time":"2024-01-22T14:07:33.014Z"}}},{"object":"block","id":"f1d0bc8d-9fa0-4ecc-9846-18815400f578","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:10:00.000Z","last_edited_time":"2022-07-30T13:14:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"GCP: Workload Identityプールにサービスアカウントを追加する","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"GCP: Workload Identityプールにサービスアカウントを追加する","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"7d327bae-f51a-4f63-87dd-c7bf3f3916b1","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:11:00.000Z","last_edited_time":"2022-07-30T13:14:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"IDプロバイダはGitHub Actionsからのリクエストに応えて一時的なアクセストークンを発行できるようになったが、そのアクセストークンはまだGCP内でなんの権限も持っていない。必要な権限を持ったサービスアカウントとアクセストークンを紐付けしなければならない。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"IDプロバイダはGitHub Actionsからのリクエストに応えて一時的なアクセストークンを発行できるようになったが、そのアクセストークンはまだGCP内でなんの権限も持っていない。必要な権限を持ったサービスアカウントとアクセストークンを紐付けしなければならない。","href":null}],"color":"default"}},{"object":"block","id":"52d78f2e-75b1-47df-9213-00d3923e9c48","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:13:00.000Z","last_edited_time":"2022-07-30T13:16:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"サービスアカウントとアクセストークンの紐付けは、Workload Identity プールからサービスアカウントへのアクセスを許可する必要がある。プールの詳細画面を開き、「アクセスを許可」からサービスアカウントの選択画面が開く。ここでアクセストークンと紐付けたいサービスアカウントを選択する。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"サービスアカウントとアクセストークンの紐付けは、Workload Identity プールからサービスアカウントへのアクセスを許可する必要がある。プールの詳細画面を開き、「アクセスを許可」からサービスアカウントの選択画面が開く。ここでアクセストークンと紐付けたいサービスアカウントを選択する。","href":null}],"color":"default"}},{"object":"block","id":"a3ba0ddf-911a-4b21-b76e-88c9c178f979","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:15:00.000Z","last_edited_time":"2022-07-30T13:15:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"file","file":{"url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/3c6255ea-b6c7-4055-8126-638d2819f0c3/4c99f4e5-c85f-4032-808b-c3ab0f9845d3/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240122%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240122T130733Z&X-Amz-Expires=3600&X-Amz-Signature=d24d7888da849e359d318b61013b28d4f652067ed7ad58237930f3a66198f816&X-Amz-SignedHeaders=host&x-id=GetObject","expiry_time":"2024-01-22T14:07:33.036Z"}}},{"object":"block","id":"03f0674f-09b9-4e42-a908-484c52953c56","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:13:00.000Z","last_edited_time":"2022-07-30T13:17:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"サービスアカウントはもともとあるものを使いまわすこともできるが、だいたいのケースではGitHub Actionsで行いたいスコープのために新しく作成して権限を絞るはず。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"サービスアカウントはもともとあるものを使いまわすこともできるが、だいたいのケースではGitHub Actionsで行いたいスコープのために新しく作成して権限を絞るはず。","href":null}],"color":"default"}},{"object":"block","id":"0eec17b7-8012-4e58-9eac-730c80e09242","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:09:00.000Z","last_edited_time":"2022-07-30T13:10:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"GitHub Actions の設定","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"GitHub Actions の設定","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"d065c40e-1c9f-46bc-8fc3-1aa4da238e7b","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:10:00.000Z","last_edited_time":"2022-07-30T13:19:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"GCP側の作業ができたので、最後にGitHub Actions側を設定して終わりになる。といっても ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"GCP側の作業ができたので、最後にGitHub Actions側を設定して終わりになる。といっても ","href":null},{"type":"text","text":{"content":"google-github-actions/auth","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"google-github-actions/auth","href":null},{"type":"text","text":{"content":" アクションがほとんど全部やってくれるので何も難しくない。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" アクションがほとんど全部やってくれるので何も難しくない。","href":null}],"color":"default"}},{"object":"block","id":"1e31040c-a0b4-417a-aeca-4079c823bbca","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:18:00.000Z","last_edited_time":"2023-08-28T21:44:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"480a5159-f46b-4a81-895c-9d56a207d9cc"},"has_children":false,"archived":false,"type":"link_preview","link_preview":{"url":"https://github.com/google-github-actions/auth"}},{"object":"block","id":"0203353f-99af-45cb-8a2b-468350299348","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-31T02:35:00.000Z","last_edited_time":"2022-07-31T02:36:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"“Usage” にドキュメンテーションされているとおり、","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"“Usage” にドキュメンテーションされているとおり、","href":null},{"type":"text","text":{"content":"permissions","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"permissions","href":null},{"type":"text","text":{"content":" に ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" に ","href":null},{"type":"text","text":{"content":"id-token: write","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"id-token: write","href":null},{"type":"text","text":{"content":" を追記し、","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を追記し、","href":null},{"type":"text","text":{"content":"actions/checkout","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"actions/checkout","href":null},{"type":"text","text":{"content":" アクションの ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" アクションの ","href":null},{"type":"text","text":{"content":"あと","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"あと","href":null},{"type":"text","text":{"content":" に、次のように認証ステップを追加する。これだけで終わり。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" に、次のように認証ステップを追加する。これだけで終わり。","href":null}],"color":"default"}},{"object":"block","id":"d5f15f39-b389-4d3a-b8a5-7a9f3249783d","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-31T02:36:00.000Z","last_edited_time":"2022-07-31T02:36:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"callout","callout":{"rich_text":[{"type":"text","text":{"content":"permissions","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"permissions","href":null},{"type":"text","text":{"content":" はひとつ設定すると設定していない権限がすべて ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" はひとつ設定すると設定していない権限がすべて ","href":null},{"type":"text","text":{"content":"none","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"none","href":null},{"type":"text","text":{"content":" になるので注意","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" になるので注意","href":null}],"icon":{"type":"emoji","emoji":"👉"},"color":"gray_background"}},{"object":"block","id":"18ee050d-9776-4fed-8f47-cd9e30156fb7","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:20:00.000Z","last_edited_time":"2022-07-30T13:23:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"      - uses: actions/checkout@v2\n      - id: 'auth'\n        uses: google-github-actions/auth@v0.8.0\n        with:\n          workload_identity_provider: 'projects/381801417627/locations/global/workloadIdentityPools/bq-sandbox-20220730/providers/bq-sandbox-provider-20220730'\n          service_account: 'bq-sandbox-worker@lacolaco-net.iam.gserviceaccount.com'","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"      - uses: actions/checkout@v2\n      - id: 'auth'\n        uses: google-github-actions/auth@v0.8.0\n        with:\n          workload_identity_provider: 'projects/381801417627/locations/global/workloadIdentityPools/bq-sandbox-20220730/providers/bq-sandbox-provider-20220730'\n          service_account: 'bq-sandbox-worker@lacolaco-net.iam.gserviceaccount.com'","href":null}],"language":"yaml"}},{"object":"block","id":"86edbc17-5a41-4ab6-bf76-25840902909b","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:20:00.000Z","last_edited_time":"2022-07-30T13:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":true,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"workload_identity_provider","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"workload_identity_provider","href":null},{"type":"text","text":{"content":" に指定する値はすこしわかりにくいが、IDプロバイダの編集画面で見れるURIから取り出せる","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" に指定する値はすこしわかりにくいが、IDプロバイダの編集画面で見れるURIから取り出せる","href":null}],"color":"default"},"children":[{"object":"block","id":"fab430f6-37e4-48a9-8141-8afe41b4dc9e","parent":{"type":"block_id","block_id":"86edbc17-5a41-4ab6-bf76-25840902909b"},"created_time":"2022-07-30T13:22:00.000Z","last_edited_time":"2022-07-30T13:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"image","image":{"caption":[],"type":"file","file":{"url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/3c6255ea-b6c7-4055-8126-638d2819f0c3/fd68f5dd-1859-4da2-91ed-e47ac2e70ba6/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240122%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240122T130734Z&X-Amz-Expires=3600&X-Amz-Signature=1a2154d85d540dce39e2cc033bbe3256e993f6b68146ab20d2f6c2a88c2e6e13&X-Amz-SignedHeaders=host&x-id=GetObject","expiry_time":"2024-01-22T14:07:34.055Z"}}}]},{"object":"block","id":"73e87c6a-d8c3-4b0a-a341-015c669d52a4","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:22:00.000Z","last_edited_time":"2022-07-30T13:23:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"service_account","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"service_account","href":null},{"type":"text","text":{"content":" のほうはプールにアクセスを許可したサービスアカウントの中から選んでメールアドレスの文字列を指定する","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" のほうはプールにアクセスを許可したサービスアカウントの中から選んでメールアドレスの文字列を指定する","href":null}],"color":"default"}},{"object":"block","id":"136c1929-152b-46c9-90b2-821ee3c3f401","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:23:00.000Z","last_edited_time":"2022-07-30T13:27:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"これだけ書ければ、後続のステップではサービスアカウントの認証が済んだ状態になっている。デフォルトで ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"これだけ書ければ、後続のステップではサービスアカウントの認証が済んだ状態になっている。デフォルトで ","href":null},{"type":"text","text":{"content":"export_environment_variables","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"export_environment_variables","href":null},{"type":"text","text":{"content":" フラグが ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" フラグが ","href":null},{"type":"text","text":{"content":"true","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"true","href":null},{"type":"text","text":{"content":" なので、多くのGCPのSDKなどが参照する環境変数はセット済みになる。たぶん何もしなくていい。必要があれば ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" なので、多くのGCPのSDKなどが参照する環境変数はセット済みになる。たぶん何もしなくていい。必要があれば ","href":null},{"type":"text","text":{"content":"steps.auth.outputs.access_token","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"steps.auth.outputs.access_token","href":null},{"type":"text","text":{"content":" などでトークンを参照することもできる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" などでトークンを参照することもできる。","href":null}],"color":"default"}},{"object":"block","id":"7cc358d6-c6be-40bf-95d9-e1edf9a57961","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:27:00.000Z","last_edited_time":"2022-07-30T13:27:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"サンプル","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"サンプル","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"4be1ef37-9f95-4962-b3dc-71e3de55c439","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:28:00.000Z","last_edited_time":"2022-07-30T13:29:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"サンプルとしてGitHub Actionsで実行されたNode.jsのスクリプトでBigQueryのAPIを呼び出している。公開レポジトリにしても大丈夫なのはもちろん属性条件をつけているからで、逆に言えば属性条件をつけなければ他のレポジトリのワークフローでも僕のBigQueryが自由に触れることになると思う。気をつけよう","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"サンプルとしてGitHub Actionsで実行されたNode.jsのスクリプトでBigQueryのAPIを呼び出している。公開レポジトリにしても大丈夫なのはもちろん属性条件をつけているからで、逆に言えば属性条件をつけなければ他のレポジトリのワークフローでも僕のBigQueryが自由に触れることになると思う。気をつけよう","href":null}],"color":"default"}},{"object":"block","id":"5a94c500-b198-4f2b-9d85-caa1abab5d12","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:27:00.000Z","last_edited_time":"2022-07-30T13:27:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bookmark","bookmark":{"caption":[],"url":"https://github.com/lacolaco/bq-sandbox/blob/main/.github/workflows/main.yml"}},{"object":"block","id":"b7747cb9-ef32-4667-9b1d-44c1d869905a","parent":{"type":"page_id","page_id":"2f780bc5-4f7d-42d7-89fd-8149884d8233"},"created_time":"2022-07-30T13:31:00.000Z","last_edited_time":"2022-07-30T13:31:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[],"color":"default"}}]