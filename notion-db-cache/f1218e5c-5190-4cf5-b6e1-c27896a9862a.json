[{"object":"block","id":"6492e63a-70e9-4d63-968e-3d614ce8b27c","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"Single State Stream パターン","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Single State Stream パターン","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"52b4f21d-cb6c-45d7-98a0-0d2df4930649","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"これはAsync Pipeを活用したリアクティブなAngularコンポーネントを作る上で、汎用性の高い実装パターンである。 テンプレートでレンダリングする","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"これはAsync Pipeを活用したリアクティブなAngularコンポーネントを作る上で、汎用性の高い実装パターンである。 テンプレートでレンダリングする","href":null},{"type":"text","text":{"content":"状態","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"状態","href":null},{"type":"text","text":{"content":"を","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"を","href":null},{"type":"text","text":{"content":"単一","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"単一","href":null},{"type":"text","text":{"content":"の","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"の","href":null},{"type":"text","text":{"content":"ストリーム","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ストリーム","href":null},{"type":"text","text":{"content":"として扱うため、私はこれを ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"として扱うため、私はこれを ","href":null},{"type":"text","text":{"content":"Single State Stream","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Single State Stream","href":null},{"type":"text","text":{"content":"パターンと名付けた。Sが3つで覚えやすい。 過去にも何度か発表で触れているが、改めて言語化して誰からも参照可能な状態にしておく。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"パターンと名付けた。Sが3つで覚えやすい。 過去にも何度か発表で触れているが、改めて言語化して誰からも参照可能な状態にしておく。","href":null}],"color":"default"}},{"object":"block","id":"fc81a3ef-7965-4793-879a-4f4a6b8cda2e","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"同じようなアイデアはng-conf 2019でDeborah Kurataさんも軽く紹介している。こちらでは ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"同じようなアイデアはng-conf 2019でDeborah Kurataさんも軽く紹介している。こちらでは ","href":null},{"type":"text","text":{"content":"vm$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"vm$","href":null},{"type":"text","text":{"content":" という名前で複数のストリームを合成しているが、ng-conf後にDeborahさんに話したところこれはSingle State Streamパターンと全く同じものだった。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" という名前で複数のストリームを合成しているが、ng-conf後にDeborahさんに話したところこれはSingle State Streamパターンと全く同じものだった。","href":null}],"color":"default"}},{"object":"block","id":"53d20638-399c-4bd4-989f-df9d7cac4d03","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T05:15:00.000Z","last_edited_time":"2023-05-21T05:15:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"video","video":{"caption":[],"type":"external","external":{"url":"https://www.youtube.com/watch?v=Z76QlSpYcck"}}},{"object":"block","id":"0740334b-5dfb-4653-92a0-2c518b3a8e3e","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"ngConf 2019: Data Composition","link":{"url":"https://docs.google.com/presentation/d/11tlfhUoyZ6WG7-UyYE3YsfiaZcy7ijPO6hA4CFKaCn8/preview?slide=id.g550602cfc5_2_141"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ngConf 2019: Data Composition","href":"https://docs.google.com/presentation/d/11tlfhUoyZ6WG7-UyYE3YsfiaZcy7ijPO6hA4CFKaCn8/preview?slide=id.g550602cfc5_2_141"}],"color":"default"}},{"object":"block","id":"81deef22-6456-455c-b6b7-dfb38f2e12e2","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"Code Example","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Code Example","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"fc10075f-cabd-48de-9c36-d983c1ecd2ca","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"コードを見て理解するのが一番早い。次の例ではコンポーネントが直接BehaviorSubjectで状態を管理しているが、これはSingle State Streamパターンをわかりやすく説明するためである。まともなアプリケーションであれば適切に状態管理のサービスに移譲する。そのパターンのコード例は後述する。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"コードを見て理解するのが一番早い。次の例ではコンポーネントが直接BehaviorSubjectで状態を管理しているが、これはSingle State Streamパターンをわかりやすく説明するためである。まともなアプリケーションであれば適切に状態管理のサービスに移譲する。そのパターンのコード例は後述する。","href":null}],"color":"default"}},{"object":"block","id":"c8ffc03e-0a53-4292-96e2-28fd3af24a33","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:15:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"type AppComponentState = {\n  user: User | null;\n  userFetching: boolean;\n}\n\nconst initialState: AppComponentState = {\n    user: null,\n    userFetching: false,\n};\n\n@Component({\n  template: `\n<ng-container *ngIf=\"state$ | async as state\">\n\n    <ng-container *ngIf=\"state.userFetching; else showUser\">\n        <loading-spinner></loading-spinner>\n    </ng-container>\n\n    <ng-template #showUser>\n        <user-display [user]=\"state.user\"></user-display>\n    </ng-template>\n\n</ng-container>\n  `\n})\nexport class AppComponent {\n  readonly state$ = new BehaviorSubject<AppComponentState>(initialState);\n\n    fetchUser() {\n        this.setState({ user: null, userFetching: true });\n\n        this.userService.fetchUser().subscribe(user => {\n            this.setState({ user, userFetching: false });\n        }, error => {\n            this.setState({ user: null, userFetching: false });\n        });\n    }\n\n  setState(state: AppComponentState) {\n        this.state$.next(state);\n    }\n}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"type AppComponentState = {\n  user: User | null;\n  userFetching: boolean;\n}\n\nconst initialState: AppComponentState = {\n    user: null,\n    userFetching: false,\n};\n\n@Component({\n  template: `\n<ng-container *ngIf=\"state$ | async as state\">\n\n    <ng-container *ngIf=\"state.userFetching; else showUser\">\n        <loading-spinner></loading-spinner>\n    </ng-container>\n\n    <ng-template #showUser>\n        <user-display [user]=\"state.user\"></user-display>\n    </ng-template>\n\n</ng-container>\n  `\n})\nexport class AppComponent {\n  readonly state$ = new BehaviorSubject<AppComponentState>(initialState);\n\n    fetchUser() {\n        this.setState({ user: null, userFetching: true });\n\n        this.userService.fetchUser().subscribe(user => {\n            this.setState({ user, userFetching: false });\n        }, error => {\n            this.setState({ user: null, userFetching: false });\n        });\n    }\n\n  setState(state: AppComponentState) {\n        this.state$.next(state);\n    }\n}","href":null}],"language":"typescript"}},{"object":"block","id":"dd1cca16-28e0-4466-8413-97451de67301","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"ComponentStateと ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ComponentStateと ","href":null},{"type":"text","text":{"content":"state$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state$","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"e07b7620-1286-40b3-96aa-99b89d06f22f","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"そのコンポーネントのテンプレートに必要な状態を定義した型を作る。上記の例では ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"そのコンポーネントのテンプレートに必要な状態を定義した型を作る。上記の例では ","href":null},{"type":"text","text":{"content":"AppComponentState","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"AppComponentState","href":null},{"type":"text","text":{"content":" 型。この型のObservableをコンポーネントに ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" 型。この型のObservableをコンポーネントに ","href":null},{"type":"text","text":{"content":"state$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state$","href":null},{"type":"text","text":{"content":" プロパティとして宣言する。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" プロパティとして宣言する。","href":null}],"color":"default"}},{"object":"block","id":"703fe9ab-cbed-4f65-b2f6-6e5eed91d769","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"単一のストリームにすることにより、ある時点での複数の非同期的な値の組み合わせをスナップショット化できる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"単一のストリームにすることにより、ある時点での複数の非同期的な値の組み合わせをスナップショット化できる。","href":null}],"color":"default"}},{"object":"block","id":"847be2f1-2028-4996-ac35-d27b422c05a2","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"この ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"この ","href":null},{"type":"text","text":{"content":"state$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state$","href":null},{"type":"text","text":{"content":" をテンプレートの最上位で ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" をテンプレートの最上位で ","href":null},{"type":"text","text":{"content":"state$ | async as state","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state$ | async as state","href":null},{"type":"text","text":{"content":" することでその内部のテンプレートに同期的な ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" することでその内部のテンプレートに同期的な ","href":null},{"type":"text","text":{"content":"state","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state","href":null},{"type":"text","text":{"content":" を注入できる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を注入できる。","href":null}],"color":"default"}},{"object":"block","id":"5d4d7a8d-f02a-48b9-8233-4cff0246d459","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"この実装パターンは、テンプレート全体をひとつのStatelessな関数のように捉えることができるところが良い。いわばReactの ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"この実装パターンは、テンプレート全体をひとつのStatelessな関数のように捉えることができるところが良い。いわばReactの ","href":null},{"type":"text","text":{"content":"render","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"render","href":null},{"type":"text","text":{"content":" 関数のように、引数として ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" 関数のように、引数として ","href":null},{"type":"text","text":{"content":"state","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state","href":null},{"type":"text","text":{"content":" が与えられることでその状態に対応したビューを描画する。いわゆる ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" が与えられることでその状態に対応したビューを描画する。いわゆる ","href":null},{"type":"text","text":{"content":"UI = f(State)","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"UI = f(State)","href":null},{"type":"text","text":{"content":" 的なアーキテクチャと相性がいい。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" 的なアーキテクチャと相性がいい。","href":null}],"color":"default"}},{"object":"block","id":"f3201b35-dd3e-4af6-a238-fecd0a01fcfe","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:15:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"// 擬似的な再現コード\nconst AppComponent = (state: AppComponentState) => {\n    if (state.userFetching) {\n        return <loading-spinner />;\n    } else {\n        return <user-display user={state.user} />;\n    }\n};","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"// 擬似的な再現コード\nconst AppComponent = (state: AppComponentState) => {\n    if (state.userFetching) {\n        return <loading-spinner />;\n    } else {\n        return <user-display user={state.user} />;\n    }\n};","href":null}],"language":"typescript"}},{"object":"block","id":"a5495754-892f-4034-8b66-4a2a9fd1b9b0","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"Storeサービスとの併用","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Storeサービスとの併用","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"975bc5e7-b959-4f25-9762-9b24b85387aa","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"上述の例ではコンポーネントが直接BehaviorSubjectを管理していたが、NgRxのStoreのような状態管理レイヤーのサービスと併用すると次のような実装パターンになる。テンプレートはまったく変わらず、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"上述の例ではコンポーネントが直接BehaviorSubjectを管理していたが、NgRxのStoreのような状態管理レイヤーのサービスと併用すると次のような実装パターンになる。テンプレートはまったく変わらず、 ","href":null},{"type":"text","text":{"content":"state$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state$","href":null},{"type":"text","text":{"content":" の作り方が変わるだけである。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の作り方が変わるだけである。","href":null}],"color":"default"}},{"object":"block","id":"1ab5907f-ba07-4d15-9135-9766610b54b8","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:16:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"type AppComponentState = {\n  user: User | null;\n  userFetching: boolean;\n}\n\n@Component({\n  template: `\n<ng-container *ngIf=\"state$ | async as state\">\n\n    <ng-container *ngIf=\"state.userFetching; else showUser\">\n        <loading-spinner></loading-spinner>\n    </ng-container>\n\n    <ng-template #showUser>\n        <user-display [user]=\"state.user\"></user-display>\n    </ng-template>\n\n</ng-container>\n  `\n})\nexport class AppComponent {\n  readonly state$: Observable<AppComponentState>;\n\n    constructor(private store: Store<AppState>) {\n        // ComponentStateへのマッピング\n        this.state$ = this.store.select(state => ({\n            user: state.user.value,\n            userFetching: state.user.fetching,\n        }));\n    }\n\n    fetchUser() {\n        this.store.dispatch(startUserFetching());\n\n        this.userService.fetchUser().subscribe(user => {\n            this.store.dispatch(finishUserFetching(user));\n        }, error => {\n            this.store.dispatch(finishUserFetching(null));\n        });\n    }\n}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"type AppComponentState = {\n  user: User | null;\n  userFetching: boolean;\n}\n\n@Component({\n  template: `\n<ng-container *ngIf=\"state$ | async as state\">\n\n    <ng-container *ngIf=\"state.userFetching; else showUser\">\n        <loading-spinner></loading-spinner>\n    </ng-container>\n\n    <ng-template #showUser>\n        <user-display [user]=\"state.user\"></user-display>\n    </ng-template>\n\n</ng-container>\n  `\n})\nexport class AppComponent {\n  readonly state$: Observable<AppComponentState>;\n\n    constructor(private store: Store<AppState>) {\n        // ComponentStateへのマッピング\n        this.state$ = this.store.select(state => ({\n            user: state.user.value,\n            userFetching: state.user.fetching,\n        }));\n    }\n\n    fetchUser() {\n        this.store.dispatch(startUserFetching());\n\n        this.userService.fetchUser().subscribe(user => {\n            this.store.dispatch(finishUserFetching(user));\n        }, error => {\n            this.store.dispatch(finishUserFetching(null));\n        });\n    }\n}","href":null}],"language":"typescript"}},{"object":"block","id":"e7cdc63b-a5ac-4c34-a460-a4e4e5e1ce3b","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"あるいは、単一データストアではなく分散型の場合は、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"あるいは、単一データストアではなく分散型の場合は、 ","href":null},{"type":"text","text":{"content":"combineLatest","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"combineLatest","href":null},{"type":"text","text":{"content":" を使った形にもできる。（この例では不自然だが）もし ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を使った形にもできる。（この例では不自然だが）もし ","href":null},{"type":"text","text":{"content":"user$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"user$","href":null},{"type":"text","text":{"content":" と ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" と ","href":null},{"type":"text","text":{"content":"userFetching$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"userFetching$","href":null},{"type":"text","text":{"content":" を別々に管理しているなら次の例のように合成すれば、これもテンプレートには全く影響がない。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を別々に管理しているなら次の例のように合成すれば、これもテンプレートには全く影響がない。","href":null}],"color":"default"}},{"object":"block","id":"ccd96967-5ce7-4579-ad78-3ebe3beb00af","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:16:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"type AppComponentState = {\n  user: User | null;\n  userFetching: boolean;\n}\n\n@Component({\n  template: `\n<ng-container *ngIf=\"state$ | async as state\">\n\n    <ng-container *ngIf=\"state.userFetching; else showUser\">\n        <loading-spinner></loading-spinner>\n    </ng-container>\n\n    <ng-template #showUser>\n        <user-display [user]=\"state.user\"></user-display>\n    </ng-template>\n\n</ng-container>\n  `\n})\nexport class AppComponent {\n  readonly state$: Observable<AppComponentState>;\n\n    constructor() {\n        this.state$ = combineLatest(\n            [user$, userFetching$],\n            ([user, userFetching]) => ({ user, userFetching }), // Destructuring\n        );\n    }\n}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"type AppComponentState = {\n  user: User | null;\n  userFetching: boolean;\n}\n\n@Component({\n  template: `\n<ng-container *ngIf=\"state$ | async as state\">\n\n    <ng-container *ngIf=\"state.userFetching; else showUser\">\n        <loading-spinner></loading-spinner>\n    </ng-container>\n\n    <ng-template #showUser>\n        <user-display [user]=\"state.user\"></user-display>\n    </ng-template>\n\n</ng-container>\n  `\n})\nexport class AppComponent {\n  readonly state$: Observable<AppComponentState>;\n\n    constructor() {\n        this.state$ = combineLatest(\n            [user$, userFetching$],\n            ([user, userFetching]) => ({ user, userFetching }), // Destructuring\n        );\n    }\n}","href":null}],"language":"typescript"}},{"object":"block","id":"a3b71231-db66-454b-a4bc-d1bf5df5ee6a","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"ここまで見たように、Single State Streamパターンではコンポーネントとテンプレートの間に ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ここまで見たように、Single State Streamパターンではコンポーネントとテンプレートの間に ","href":null},{"type":"text","text":{"content":"state$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state$","href":null},{"type":"text","text":{"content":" が挟まることである種のクッションとして働き、アプリケーションの状態管理がどのように変わっても、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" が挟まることである種のクッションとして働き、アプリケーションの状態管理がどのように変わっても、 ","href":null},{"type":"text","text":{"content":"state$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state$","href":null},{"type":"text","text":{"content":" のインターフェースさえ維持されていればコンポーネントのレンダリングには影響を与えないようになる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" のインターフェースさえ維持されていればコンポーネントのレンダリングには影響を与えないようになる。","href":null}],"color":"default"}},{"object":"block","id":"89326f7e-61fc-4b90-97df-b82dc7f151a8","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"言い換えれば、どのようなアプリケーションのアーキテクチャにおいてもSingle State Streamパターンは適合する。特に、Container / Presentational のようなコンポーネント設計をしている場合には、Containerコンポーネントにとてもよくマッチする。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"言い換えれば、どのようなアプリケーションのアーキテクチャにおいてもSingle State Streamパターンは適合する。特に、Container / Presentational のようなコンポーネント設計をしている場合には、Containerコンポーネントにとてもよくマッチする。","href":null}],"color":"default"}},{"object":"block","id":"226c2369-4a3c-47cf-a97e-890d8a0fbeef","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"また、コンポーネントをテストするときにも ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"また、コンポーネントをテストするときにも ","href":null},{"type":"text","text":{"content":"state$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state$","href":null},{"type":"text","text":{"content":" の値を更新するだけでよいので、テンプレートのレンダリング結果をユニットテストしやすい。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の値を更新するだけでよいので、テンプレートのレンダリング結果をユニットテストしやすい。","href":null}],"color":"default"}},{"object":"block","id":"c4f13cd2-dac7-4515-b0de-f125e85933cc","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"Single State Streamパターンのデメリット","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Single State Streamパターンのデメリット","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"c4d0c2c2-24c5-48c6-99e3-10c7447fdb63","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"ComponentStateが複雑になる、つまり ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ComponentStateが複雑になる、つまり ","href":null},{"type":"text","text":{"content":"state$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state$","href":null},{"type":"text","text":{"content":" のプロパティが増えてくると少し問題が出てくる。 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" のプロパティが増えてくると少し問題が出てくる。 ","href":null},{"type":"text","text":{"content":"state$","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state$","href":null},{"type":"text","text":{"content":" の値が変わるたびにテンプレート全体の評価が行われるため、互いに関連性の少ないプロパティが増えてくると無駄な計算処理が増えてしまう。 この問題は ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の値が変わるたびにテンプレート全体の評価が行われるため、互いに関連性の少ないプロパティが増えてくると無駄な計算処理が増えてしまう。 この問題は ","href":null},{"type":"text","text":{"content":"@Input","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@Input","href":null},{"type":"text","text":{"content":" で値を受け取る側のコンポーネントのChange Detection Strategyを ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" で値を受け取る側のコンポーネントのChange Detection Strategyを ","href":null},{"type":"text","text":{"content":"OnPush","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"OnPush","href":null},{"type":"text","text":{"content":" にすることで大幅に緩和できる。Async Pipeがある部分だけはどうしようもないが、それぞれの子コンポーネントの先が再評価されなければパフォーマンスにはほぼ影響はない。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" にすることで大幅に緩和できる。Async Pipeがある部分だけはどうしようもないが、それぞれの子コンポーネントの先が再評価されなければパフォーマンスにはほぼ影響はない。","href":null}],"color":"default"}},{"object":"block","id":"4ea58500-481e-4486-a834-0acb7fa8cc8f","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"下記の例では、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"下記の例では、 ","href":null},{"type":"text","text":{"content":"[state.foo](http://state.foo)","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"[state.foo](http://state.foo)","href":null},{"type":"text","text":{"content":" だけが変化した場合でも ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" だけが変化した場合でも ","href":null},{"type":"text","text":{"content":"state","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state","href":null},{"type":"text","text":{"content":" オブジェクトの値が変われば当然 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" オブジェクトの値が変われば当然 ","href":null},{"type":"text","text":{"content":"ng-container","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"ng-container","href":null},{"type":"text","text":{"content":" 内の再評価が行われる。OnPushを使わなければ ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" 内の再評価が行われる。OnPushを使わなければ ","href":null},{"type":"text","text":{"content":"[state.bar](http://state.bar)","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"[state.bar](http://state.bar)","href":null},{"type":"text","text":{"content":"に変化がなくても ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"に変化がなくても ","href":null},{"type":"text","text":{"content":"<bar-display>","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"<bar-display>","href":null},{"type":"text","text":{"content":" と ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" と ","href":null},{"type":"text","text":{"content":"<baz-display>","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"<baz-display>","href":null},{"type":"text","text":{"content":" までもが一緒に再評価されてしまうが、OnPushを使えば ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" までもが一緒に再評価されてしまうが、OnPushを使えば ","href":null},{"type":"text","text":{"content":"state.bar","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"state.bar","href":null},{"type":"text","text":{"content":" が変わらない限り ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" が変わらない限り ","href":null},{"type":"text","text":{"content":"<bar-display>","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"<bar-display>","href":null},{"type":"text","text":{"content":" は再評価されない。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" は再評価されない。","href":null}],"color":"default"}},{"object":"block","id":"5b43a833-4eab-48f9-920e-a5390362b4b6","parent":{"type":"page_id","page_id":"f1218e5c-5190-4cf5-b6e1-c27896a9862a"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:16:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"<ng-container *ngIf=\"state$ | async as state\">\n\n    <foo-display [value]=\"state.foo\"></foo-display>\n\n    <bar-display [value]=\"state.bar\"></bar-display>\n\n    <baz-display [value]=\"state.baz\"></baz-display>\n\n</ng-container>","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"<ng-container *ngIf=\"state$ | async as state\">\n\n    <foo-display [value]=\"state.foo\"></foo-display>\n\n    <bar-display [value]=\"state.bar\"></bar-display>\n\n    <baz-display [value]=\"state.baz\"></baz-display>\n\n</ng-container>","href":null}],"language":"html"}}]