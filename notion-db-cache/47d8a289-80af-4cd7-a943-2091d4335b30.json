[{"object":"block","id":"08b37698-925f-4b34-96c5-312fd0b7415e","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:01:00.000Z","last_edited_time":"2022-02-16T00:01:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"bookmark","bookmark":{"caption":[],"url":"https://blog.lacolaco.net/2022/02/notion-headless-cms-2/"}},{"object":"block","id":"05e49346-3743-4ec8-acf2-af24196eeae4","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:01:00.000Z","last_edited_time":"2022-02-16T00:32:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"前回に引き続き、今回はNotionで書いた記事をGitレポジトリへ自動的に取り込み、Hugoでビルドしてデプロイするまでの流れで躓いた点をまとめる。今回が最終回だ。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"前回に引き続き、今回はNotionで書いた記事をGitレポジトリへ自動的に取り込み、Hugoでビルドしてデプロイするまでの流れで躓いた点をまとめる。今回が最終回だ。","href":null}],"color":"default"}},{"object":"block","id":"458a21bd-2ec7-4213-bfd6-6792402788f3","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:03:00.000Z","last_edited_time":"2022-02-16T00:04:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"Notionの変更からGitHub Actionsをトリガーしたい","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Notionの変更からGitHub Actionsをトリガーしたい","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"8b6aa5ff-d9a3-4bf0-a537-3216b4973874","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:04:00.000Z","last_edited_time":"2022-02-16T00:07:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"まず思いつくのは Notion のデータベース更新からWebhookを受け取り、GitHub Actionsの ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"まず思いつくのは Notion のデータベース更新からWebhookを受け取り、GitHub Actionsの ","href":null},{"type":"text","text":{"content":"repository_dispatch","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"repository_dispatch","href":null},{"type":"text","text":{"content":" トリガーに連携する方法だが、残念ながら今のNotionにはまだWebhook機能がない。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" トリガーに連携する方法だが、残念ながら今のNotionにはまだWebhook機能がない。","href":null}],"color":"default"}},{"object":"block","id":"ff28bcb3-4b48-43d4-bb44-f896bf8e4c0e","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:07:00.000Z","last_edited_time":"2022-02-16T00:09:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"IFTTTやzapierのようなサービスを使うと（何故か）Notionのデータベース変更イベントからアクションできるが、この程度のために外部サービスを使うのも癪なので、愚直ではあるが GitHub Actions の ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"IFTTTやzapierのようなサービスを使うと（何故か）Notionのデータベース変更イベントからアクションできるが、この程度のために外部サービスを使うのも癪なので、愚直ではあるが GitHub Actions の ","href":null},{"type":"text","text":{"content":"schedule","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"schedule","href":null},{"type":"text","text":{"content":" トリガーで変更監視を定期実行するようにした。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" トリガーで変更監視を定期実行するようにした。","href":null}],"color":"default"}},{"object":"block","id":"41ee1b91-1960-443d-add3-88f5c95eeac6","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:09:00.000Z","last_edited_time":"2022-02-16T00:10:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"また、最近のアップデートで ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"また、最近のアップデートで ","href":null},{"type":"text","text":{"content":"workflow_dispatch","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"workflow_dispatch","href":null},{"type":"text","text":{"content":" トリガーが追加され、GitHubのUI上から手動でワークフローを開始できるのでデバッグ用に追加して次のようなワークフローができた。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" トリガーが追加され、GitHubのUI上から手動でワークフローを開始できるのでデバッグ用に追加して次のようなワークフローができた。","href":null}],"color":"default"}},{"object":"block","id":"9df05e0e-0768-486b-8f22-4ec2330efebb","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:10:00.000Z","last_edited_time":"2022-02-16T00:39:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"name: sync-with-notion\n\non:\n  schedule:\n    - cron: '0/10 * * * *'\n  workflow_dispatch:\n\njobs:\n  sync:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v2\n      - uses: actions/setup-node@v2\n        with:\n          node-version: '16.x'\n          cache: yarn\n      - run: yarn install\n      - run: yarn notion:fetch\n        env:\n          NOTION_AUTH_TOKEN: ${{ secrets.NOTION_AUTH_TOKEN }}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"name: sync-with-notion\n\non:\n  schedule:\n    - cron: '0/10 * * * *'\n  workflow_dispatch:\n\njobs:\n  sync:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v2\n      - uses: actions/setup-node@v2\n        with:\n          node-version: '16.x'\n          cache: yarn\n      - run: yarn install\n      - run: yarn notion:fetch\n        env:\n          NOTION_AUTH_TOKEN: ${{ secrets.NOTION_AUTH_TOKEN }}","href":null}],"language":"yaml"}},{"object":"block","id":"e462fdc0-8d2e-477f-b70b-bcfd13968fbb","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:11:00.000Z","last_edited_time":"2022-02-16T00:11:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"heading_3","heading_3":{"rich_text":[{"type":"text","text":{"content":"DIffが生まれたらプルリクエストを作る","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"DIffが生まれたらプルリクエストを作る","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"dffce2ec-ea67-43ef-9fd6-933df5a31966","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:11:00.000Z","last_edited_time":"2022-02-16T00:13:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"定期実行するワークフローで Notion API からMarkdownファイルを作成した結果、メインブランチと diff が発生したら、その変更を取り込むためのプルリクエストを自動生成する。これによりNotion の内容が（ほぼ）常にGitレポジトリへ一方的に同期される。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"定期実行するワークフローで Notion API からMarkdownファイルを作成した結果、メインブランチと diff が発生したら、その変更を取り込むためのプルリクエストを自動生成する。これによりNotion の内容が（ほぼ）常にGitレポジトリへ一方的に同期される。","href":null}],"color":"default"}},{"object":"block","id":"1e83fe07-7b07-4f1b-b482-7536b6551c04","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:13:00.000Z","last_edited_time":"2022-02-16T00:16:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"GitHub Actions で何らかのdiffを作ってプルリクエストを作るのは、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"GitHub Actions で何らかのdiffを作ってプルリクエストを作るのは、 ","href":null},{"type":"text","text":{"content":"Create Pull Request","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"Create Pull Request","href":null},{"type":"text","text":{"content":" アクションが非常に便利だ。一般的なユースケースをカバーした上でいろいろカスタマイズできる。こうしたワークフローで頻発するベースブランチとのコンフリクトや outdated 化などにも自動的に対応してくれる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" アクションが非常に便利だ。一般的なユースケースをカバーした上でいろいろカスタマイズできる。こうしたワークフローで頻発するベースブランチとのコンフリクトや outdated 化などにも自動的に対応してくれる。","href":null}],"color":"default"}},{"object":"block","id":"bf94a5eb-215b-406f-af3c-7b1f3a82a0f8","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:14:00.000Z","last_edited_time":"2022-02-16T00:14:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"https://github.com/peter-evans/create-pull-request","link":{"url":"https://github.com/peter-evans/create-pull-request"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"https://github.com/peter-evans/create-pull-request","href":"https://github.com/peter-evans/create-pull-request"}],"color":"default"}},{"object":"block","id":"3c5c04cb-5310-48d0-9632-1f95d647bed7","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:16:00.000Z","last_edited_time":"2022-02-16T00:17:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"heading_3","heading_3":{"rich_text":[{"type":"text","text":{"content":"botが作ったプルリクエストは別のワークフローをトリガーしない","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"botが作ったプルリクエストは別のワークフローをトリガーしない","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"c51a9c65-f447-4023-9f16-dcaffae23def","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:17:00.000Z","last_edited_time":"2022-02-16T00:18:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"ところが落とし穴がひとつあった。GitHub Actionsで提供される ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ところが落とし穴がひとつあった。GitHub Actionsで提供される ","href":null},{"type":"text","text":{"content":"secrets.GITHUB_TOKEN","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"secrets.GITHUB_TOKEN","href":null},{"type":"text","text":{"content":" を認証情報としてGitHub APIを呼び出すと、作成したプルリクエストは","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を認証情報としてGitHub APIを呼び出すと、作成したプルリクエストは","href":null},{"type":"text","text":{"content":"別のワークフローをトリガーしない","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"別のワークフローをトリガーしない","href":null},{"type":"text","text":{"content":"ことになっている。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ことになっている。","href":null}],"color":"default"}},{"object":"block","id":"184c76ac-c476-4b14-8b5e-ecab8ddcd8d5","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:21:00.000Z","last_edited_time":"2022-02-16T00:21:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"bookmark","bookmark":{"caption":[],"url":"https://docs.github.com/en/actions/using-workflows/triggering-a-workflow"}},{"object":"block","id":"7f719dca-1292-4780-9706-d02fa509cb17","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:21:00.000Z","last_edited_time":"2022-02-16T00:21:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"quote","quote":{"rich_text":[{"type":"text","text":{"content":"When you use the repository's ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"When you use the repository's ","href":null},{"type":"text","text":{"content":"GITHUB_TOKEN","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"GITHUB_TOKEN","href":null},{"type":"text","text":{"content":" to perform tasks, events triggered by the ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" to perform tasks, events triggered by the ","href":null},{"type":"text","text":{"content":"GITHUB_TOKEN","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"GITHUB_TOKEN","href":null},{"type":"text","text":{"content":" will not create a new workflow run. This prevents you from accidentally creating recursive workflow runs.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" will not create a new workflow run. This prevents you from accidentally creating recursive workflow runs.","href":null}],"color":"default"}},{"object":"block","id":"c4e6c59b-9957-465a-a634-9059cb7e4d4a","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:21:00.000Z","last_edited_time":"2022-02-16T00:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"プルリクエストが作成されたら Firebase Hosting のプレビューチャンネルへデプロイして表示確認できるようにしていたため、 Notion 記事反映のプルリクエストからプレビューが作られないのは問題である。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"プルリクエストが作成されたら Firebase Hosting のプレビューチャンネルへデプロイして表示確認できるようにしていたため、 Notion 記事反映のプルリクエストからプレビューが作られないのは問題である。","href":null}],"color":"default"}},{"object":"block","id":"343e7bb9-bc5e-476a-a71c-2ba8986992c3","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:22:00.000Z","last_edited_time":"2022-02-16T00:23:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"この問題を解決する方法も ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"この問題を解決する方法も ","href":null},{"type":"text","text":{"content":"Create Pull Request","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"Create Pull Request","href":null},{"type":"text","text":{"content":" の作者はフォローしていて、ドキュメントにいくつかの選択肢を載せてくれている。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の作者はフォローしていて、ドキュメントにいくつかの選択肢を載せてくれている。","href":null}],"color":"default"}},{"object":"block","id":"df8b1400-7457-45c9-b9ad-595ae7833735","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:23:00.000Z","last_edited_time":"2022-02-16T00:23:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"bookmark","bookmark":{"caption":[],"url":"https://github.com/peter-evans/create-pull-request/blob/main/docs/concepts-guidelines.md#triggering-further-workflow-runs"}},{"object":"block","id":"22e6aecb-c802-4483-a15c-cd28bc322c77","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:23:00.000Z","last_edited_time":"2022-02-16T00:25:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"結局のところ、デフォルトで提供されている ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"結局のところ、デフォルトで提供されている ","href":null},{"type":"text","text":{"content":"secrets.GITHUB_TOKEN","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"secrets.GITHUB_TOKEN","href":null},{"type":"text","text":{"content":" でさえなければ何でもいいので、今回はトークンのスコープを狭める観点からプライベートの GitHub Apps を使った方法を選んだ。詳細は書かないが、最終的に次のようなワークフローになった。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" でさえなければ何でもいいので、今回はトークンのスコープを狭める観点からプライベートの GitHub Apps を使った方法を選んだ。詳細は書かないが、最終的に次のようなワークフローになった。","href":null}],"color":"default"}},{"object":"block","id":"afc255a7-aae3-4efe-b6c7-c97760336b01","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:25:00.000Z","last_edited_time":"2022-02-16T00:40:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"name: sync-with-notion\n\non:\n  schedule:\n    - cron: '0/10 * * * *'\n  workflow_dispatch:\n\njobs:\n  sync:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v2\n      - uses: actions/setup-node@v2\n        with:\n          node-version: '16.x'\n          cache: yarn\n      # https://github.com/peter-evans/create-pull-request/blob/main/docs/concepts-guidelines.md#authenticating-with-github-app-generated-tokens\n      - uses: tibdex/github-app-token@v1\n        id: generate-token\n        with:\n          app_id: ${{ secrets.WORKER_APP_ID }}\n          private_key: ${{ secrets.WORKER_APP_PRIVATE_KEY }}\n      - run: yarn install\n      - run: yarn notion:fetch\n        env:\n          NOTION_AUTH_TOKEN: ${{ secrets.NOTION_AUTH_TOKEN }}\n      - name: Create Pull Request\n        uses: peter-evans/create-pull-request@v3\n        with:\n          token: ${{ steps.generate-token.outputs.token }}\n          commit-message: 'fix: apply changes from Notion'\n          branch: sync-with-notion\n          delete-branch: true\n          title: 'fix: apply changes from Notion'\n          body: '@lacolaco Review and apply changes from Notion'","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"name: sync-with-notion\n\non:\n  schedule:\n    - cron: '0/10 * * * *'\n  workflow_dispatch:\n\njobs:\n  sync:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v2\n      - uses: actions/setup-node@v2\n        with:\n          node-version: '16.x'\n          cache: yarn\n      # https://github.com/peter-evans/create-pull-request/blob/main/docs/concepts-guidelines.md#authenticating-with-github-app-generated-tokens\n      - uses: tibdex/github-app-token@v1\n        id: generate-token\n        with:\n          app_id: ${{ secrets.WORKER_APP_ID }}\n          private_key: ${{ secrets.WORKER_APP_PRIVATE_KEY }}\n      - run: yarn install\n      - run: yarn notion:fetch\n        env:\n          NOTION_AUTH_TOKEN: ${{ secrets.NOTION_AUTH_TOKEN }}\n      - name: Create Pull Request\n        uses: peter-evans/create-pull-request@v3\n        with:\n          token: ${{ steps.generate-token.outputs.token }}\n          commit-message: 'fix: apply changes from Notion'\n          branch: sync-with-notion\n          delete-branch: true\n          title: 'fix: apply changes from Notion'\n          body: '@lacolaco Review and apply changes from Notion'","href":null}],"language":"yaml"}},{"object":"block","id":"6b044523-b490-4c51-861a-dcd1cdd928ae","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:25:00.000Z","last_edited_time":"2022-02-16T00:26:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"これで、Notionで記事を書けば約10分後にはGitHubに取り込みプルリクエストが作成され、自動デプロイされたプレビュー環境で表示のチェックができるようになった。完成である。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"これで、Notionで記事を書けば約10分後にはGitHubに取り込みプルリクエストが作成され、自動デプロイされたプレビュー環境で表示のチェックができるようになった。完成である。","href":null}],"color":"default"}},{"object":"block","id":"33a4dba9-cc37-4405-91dd-2bf6ecc39cd3","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:44:00.000Z","last_edited_time":"2022-02-16T00:44:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"image","image":{"caption":[],"type":"file","file":{"url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/3c6255ea-b6c7-4055-8126-638d2819f0c3/a77e6ae3-f511-4160-b81b-0582ca167cf7/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45HZZMZUHI%2F20240703%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20240703T031019Z&X-Amz-Expires=3600&X-Amz-Signature=7e47a3f0ed03cb8d08a04c855b84362f35dea4c938ee873d91ea6d4485a88812&X-Amz-SignedHeaders=host&x-id=GetObject","expiry_time":"2024-07-03T04:10:19.936Z"}}},{"object":"block","id":"79d16c79-df94-4602-a79b-00fa9bfd1f15","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:26:00.000Z","last_edited_time":"2022-02-16T00:27:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"NotionにWebhookができればもう少しスマートになるが、今のAPIの使い方でもレートリミットなどは問題なさそうなのでしばらくはこのまま運用する。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"NotionにWebhookができればもう少しスマートになるが、今のAPIの使い方でもレートリミットなどは問題なさそうなのでしばらくはこのまま運用する。","href":null}],"color":"default"}},{"object":"block","id":"91db0362-5cd3-43ae-b98f-401c124babb0","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:28:00.000Z","last_edited_time":"2022-02-16T00:28:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"bookmark","bookmark":{"caption":[],"url":"https://developers.notion.com/reference/request-limits"}},{"object":"block","id":"e51c87d7-06e6-491d-b811-1bb00678ee13","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:28:00.000Z","last_edited_time":"2022-02-16T00:28:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"まとめ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"まとめ","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"025b55ac-ca3e-437d-89fb-ffae103b3db2","parent":{"type":"page_id","page_id":"47d8a289-80af-4cd7-a943-2091d4335b30"},"created_time":"2022-02-16T00:28:00.000Z","last_edited_time":"2022-02-16T00:32:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"in_trash":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"3回に分けて、NotionをこのブログのヘッドレスCMSとして使えるようにするにあたって苦労した点をまとめた。ほぼ自分用の備忘録と、実際にNotionで記事を書けると捗るのかどうかの実験を兼ねたものだが、もし似たようなものを作ろうとする誰かの参考になるなら幸いである。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"3回に分けて、NotionをこのブログのヘッドレスCMSとして使えるようにするにあたって苦労した点をまとめた。ほぼ自分用の備忘録と、実際にNotionで記事を書けると捗るのかどうかの実験を兼ねたものだが、もし似たようなものを作ろうとする誰かの参考になるなら幸いである。","href":null}],"color":"default"}}]