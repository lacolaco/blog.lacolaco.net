[{"object":"block","id":"2c77634b-6ed0-482f-95a3-1c850d764e83","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"最近Angularチームが発見し、Angularライブラリの実装におけるパターンとして普及させようとしているのが、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"最近Angularチームが発見し、Angularライブラリの実装におけるパターンとして普及させようとしているのが、 ","href":null},{"type":"text","text":{"content":"Lightweight Injection Token","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Lightweight Injection Token","href":null},{"type":"text","text":{"content":" というテクニックだ。これはこれまで不可能だった ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" というテクニックだ。これはこれまで不可能だった ","href":null},{"type":"text","text":{"content":"コンポーネント(ディレクティブ)のTree-Shaking","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"コンポーネント(ディレクティブ)のTree-Shaking","href":null},{"type":"text","text":{"content":" を可能にする。本稿ではこの新しいテクニックの概要、そして生まれた経緯や深く知るための参考リンクをまとめる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を可能にする。本稿ではこの新しいテクニックの概要、そして生まれた経緯や深く知るための参考リンクをまとめる。","href":null}],"color":"default"}},{"object":"block","id":"65fc601d-2a9c-4d69-b811-e91a5468ea4e","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"なお、Lightweight Injection Tokenについては公式ドキュメントでも解説される予定であるため、そちらを参照すればいい部分は省略する。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"なお、Lightweight Injection Tokenについては公式ドキュメントでも解説される予定であるため、そちらを参照すればいい部分は省略する。","href":null}],"color":"default"}},{"object":"block","id":"4ada61ca-c8b4-4654-a136-ff3b00bdf3ad","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"Angular - Optimizing client app size with lightweight injection tokens","link":{"url":"https://next.angular.io/guide/lightweight-injection-tokens"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Angular - Optimizing client app size with lightweight injection tokens","href":"https://next.angular.io/guide/lightweight-injection-tokens"}],"color":"default"}},{"object":"block","id":"e34feed9-e9fd-41da-97c0-978875886fe1","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"Lightweight Injection Tokenの概要","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Lightweight Injection Tokenの概要","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"a3b2da55-ae7a-4632-b0cc-4b9bc965edd7","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"ひとことでいえば、「オプショナルな機能に関連するInjection Tokenとして代替の軽量トークンを使う」ということである。AngularのDIを深く理解していればこれだけでピンと来るかもしれないが、具体例から概要をつかもう。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ひとことでいえば、「オプショナルな機能に関連するInjection Tokenとして代替の軽量トークンを使う」ということである。AngularのDIを深く理解していればこれだけでピンと来るかもしれないが、具体例から概要をつかもう。","href":null}],"color":"default"}},{"object":"block","id":"b3bc82d5-6dc4-4ab8-b9f8-c3026e4570fd","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"あるAngularライブラリが、次のような使い方ができる ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"あるAngularライブラリが、次のような使い方ができる ","href":null},{"type":"text","text":{"content":"<lib-card>","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"<lib-card>","href":null},{"type":"text","text":{"content":" コンポーネントを提供している。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" コンポーネントを提供している。","href":null}],"color":"default"}},{"object":"block","id":"d96af219-53f5-4594-9d46-5abb1ab518e5","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:21:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"<lib-card>\n  Hello World!\n</lib-card>","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"<lib-card>\n  Hello World!\n</lib-card>","href":null}],"language":"html"}},{"object":"block","id":"b6b888fc-c760-4cde-aa7b-7c97c2de6a37","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"このコンポーネントは、Contentとして ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"このコンポーネントは、Contentとして ","href":null},{"type":"text","text":{"content":"<lib-card-header>","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"<lib-card-header>","href":null},{"type":"text","text":{"content":" コンポーネントを配置すると、カードのヘッダーとして取り扱う ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" コンポーネントを配置すると、カードのヘッダーとして取り扱う ","href":null},{"type":"text","text":{"content":"オプショナル","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"オプショナル","href":null},{"type":"text","text":{"content":" な機能があることをイメージしよう。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" な機能があることをイメージしよう。","href":null}],"color":"default"}},{"object":"block","id":"c66b986f-fd8d-4fa3-a7df-14fd83b556d2","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:21:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"<lib-card>\n  <lib-card-header>Greeting Card</lib-card-header>\n  Hello World!\n</lib-card>","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"<lib-card>\n  <lib-card-header>Greeting Card</lib-card-header>\n  Hello World!\n</lib-card>","href":null}],"language":"html"}},{"object":"block","id":"eb0f29c5-9803-4ea2-a95d-60cc28f65185","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"ライブラリ側はこのような使い方ができるコンポーネントを実装するとおおよそ次のようになるだろう。 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ライブラリ側はこのような使い方ができるコンポーネントを実装するとおおよそ次のようになるだろう。 ","href":null},{"type":"text","text":{"content":"@ContentChild()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ContentChild()","href":null},{"type":"text","text":{"content":" を使って ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を使って ","href":null},{"type":"text","text":{"content":"CardHeaderComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderComponent","href":null},{"type":"text","text":{"content":" の参照を得る。ただしこのヘッダーを置くかどうかはユーザー次第なので、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の参照を得る。ただしこのヘッダーを置くかどうかはユーザー次第なので、 ","href":null},{"type":"text","text":{"content":"CardHeaderComponent|null","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderComponent|null","href":null},{"type":"text","text":{"content":" という形でnullを許容することになる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" という形でnullを許容することになる。","href":null}],"color":"default"}},{"object":"block","id":"a9e2cfe8-e2ce-4e2d-a07e-7e325368fafa","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:21:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"@Component({\n  selector: 'lib-card-header',\n  ...,\n})\nclass CardHeaderComponent {}\n\n@Component({\n  selector: 'lib-card',\n  ...,\n})\nclass CardComponent {\n  @ContentChild(CardHeaderComponent)\n  header: CardHeaderComponent|null = null;\n}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"@Component({\n  selector: 'lib-card-header',\n  ...,\n})\nclass CardHeaderComponent {}\n\n@Component({\n  selector: 'lib-card',\n  ...,\n})\nclass CardComponent {\n  @ContentChild(CardHeaderComponent)\n  header: CardHeaderComponent|null = null;\n}","href":null}],"language":"plain text"}},{"object":"block","id":"21e402ec-3fe3-44b7-a058-67560e345980","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"ここで問題になるのが、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ここで問題になるのが、 ","href":null},{"type":"text","text":{"content":"CardComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardComponent","href":null},{"type":"text","text":{"content":" から ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" から ","href":null},{"type":"text","text":{"content":"CardHeaderComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderComponent","href":null},{"type":"text","text":{"content":" への参照の持ち方である。 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" への参照の持ち方である。 ","href":null},{"type":"text","text":{"content":"@ContentChild(CardHeaderComponent)","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ContentChild(CardHeaderComponent)","href":null},{"type":"text","text":{"content":" と ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" と ","href":null},{"type":"text","text":{"content":"header: CardHeaderComponent|null","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"header: CardHeaderComponent|null","href":null},{"type":"text","text":{"content":" の2箇所で参照を持っているが、この2つは性質が異なる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の2箇所で参照を持っているが、この2つは性質が異なる。","href":null}],"color":"default"}},{"object":"block","id":"b7610a8b-2cf0-4b42-a8fb-910454d530df","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"後者の ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"後者の ","href":null},{"type":"text","text":{"content":"header: CardHeaderComponent|null","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"header: CardHeaderComponent|null","href":null},{"type":"text","text":{"content":" は、","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" は、","href":null},{"type":"text","text":{"content":"型","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"型","href":null},{"type":"text","text":{"content":"としての参照である。この参照はTypeScriptのコンパイル時型チェックにのみ用いられ、コンパイル後のJavaScriptには残らないため問題にならない。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"としての参照である。この参照はTypeScriptのコンパイル時型チェックにのみ用いられ、コンパイル後のJavaScriptには残らないため問題にならない。","href":null}],"color":"default"}},{"object":"block","id":"9a370745-fba3-4b69-9b62-9fdb8f8b6b43","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"問題は前者の ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"問題は前者の ","href":null},{"type":"text","text":{"content":"@ContentChild(CardHeaderComponent)","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ContentChild(CardHeaderComponent)","href":null},{"type":"text","text":{"content":" だ。これは","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" だ。これは","href":null},{"type":"text","text":{"content":"値","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"値","href":null},{"type":"text","text":{"content":"としての参照であり、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"としての参照であり、 ","href":null},{"type":"text","text":{"content":"CardHeaderComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderComponent","href":null},{"type":"text","text":{"content":" というクラスオブジェクトそのものを参照している。それが直接 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" というクラスオブジェクトそのものを参照している。それが直接 ","href":null},{"type":"text","text":{"content":"@ContentChild()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ContentChild()","href":null},{"type":"text","text":{"content":" デコレーターに渡されているのだから、","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" デコレーターに渡されているのだから、","href":null},{"type":"text","text":{"content":"ユーザーがヘッダーを使おうが使わまいが、この参照は実行時に残る","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ユーザーがヘッダーを使おうが使わまいが、この参照は実行時に残る","href":null},{"type":"text","text":{"content":"。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"。","href":null}],"color":"default"}},{"object":"block","id":"715d70e0-b338-4a97-a396-f4ffcc7efb98","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"@ViewChild()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ViewChild()","href":null},{"type":"text","text":{"content":" や ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" や ","href":null},{"type":"text","text":{"content":"@ContentChild()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ContentChild()","href":null},{"type":"text","text":{"content":" の走査条件として使われるコンポーネント/ディレクティブのクラス参照はどうしてもTree-Shakingできず、これがAngularライブラリを利用したときの","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の走査条件として使われるコンポーネント/ディレクティブのクラス参照はどうしてもTree-Shakingできず、これがAngularライブラリを利用したときの","href":null},{"type":"text","text":{"content":"バンドルサイズの肥大化の原因","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"バンドルサイズの肥大化の原因","href":null},{"type":"text","text":{"content":"となる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"となる。","href":null}],"color":"default"}},{"object":"block","id":"48874b5c-ff9e-4bbd-a6eb-9e3e94dad2a2","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"これを解決するためのアプローチが、Lightweight Injection Tokenだ。上記の例で ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"これを解決するためのアプローチが、Lightweight Injection Tokenだ。上記の例で ","href":null},{"type":"text","text":{"content":"@ContentChild()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ContentChild()","href":null},{"type":"text","text":{"content":" デコレーターに渡していたクラスを、次のように軽量なオブジェクトを利用したInjection Tokenに置き換える。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" デコレーターに渡していたクラスを、次のように軽量なオブジェクトを利用したInjection Tokenに置き換える。","href":null}],"color":"default"}},{"object":"block","id":"208064c6-1316-4a69-aad2-e93ce4bae690","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:21:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"// Lightweight Injection Token\nabstract class CardHeaderToken {}\n\n@Component({\n  selector: 'lib-card-header',\n  providers: [\n    {provide: CardHeaderToken, useExisting: CardHeaderComponent}\n  ]\n  ...,\n})\nclass CardHeaderComponent extends CardHeaderToken {}\n\n@Component({\n  selector: 'lib-card',\n  ...,\n})\nclass CardComponent {\n  @ContentChild(CardHeaderToken) header: CardHeaderToken|null = null;\n}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"// Lightweight Injection Token\nabstract class CardHeaderToken {}\n\n@Component({\n  selector: 'lib-card-header',\n  providers: [\n    {provide: CardHeaderToken, useExisting: CardHeaderComponent}\n  ]\n  ...,\n})\nclass CardHeaderComponent extends CardHeaderToken {}\n\n@Component({\n  selector: 'lib-card',\n  ...,\n})\nclass CardComponent {\n  @ContentChild(CardHeaderToken) header: CardHeaderToken|null = null;\n}","href":null}],"language":"plain text"}},{"object":"block","id":"c7930833-438d-45fc-8045-079695a0de97","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"まず ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"まず ","href":null},{"type":"text","text":{"content":"CardHeaderToken","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderToken","href":null},{"type":"text","text":{"content":" 抽象クラスを作成し、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" 抽象クラスを作成し、 ","href":null},{"type":"text","text":{"content":"CardHeaderComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderComponent","href":null},{"type":"text","text":{"content":" をその具象クラスとする。そしてコンポーネントプロバイダーで ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" をその具象クラスとする。そしてコンポーネントプロバイダーで ","href":null},{"type":"text","text":{"content":"CardHeaderToken","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderToken","href":null},{"type":"text","text":{"content":" に対して自身のクラスオブジェクトを提供する。 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" に対して自身のクラスオブジェクトを提供する。 ","href":null},{"type":"text","text":{"content":"CardComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardComponent","href":null},{"type":"text","text":{"content":" ではトークンを ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" ではトークンを ","href":null},{"type":"text","text":{"content":"@ContentChild()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ContentChild()","href":null},{"type":"text","text":{"content":"デコレーターの走査条件とする。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"デコレーターの走査条件とする。","href":null}],"color":"default"}},{"object":"block","id":"aeb95644-893a-4067-b7bf-8a83229f1576","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"これにより、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"これにより、 ","href":null},{"type":"text","text":{"content":"CardComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardComponent","href":null},{"type":"text","text":{"content":" から直接の ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" から直接の ","href":null},{"type":"text","text":{"content":"CardHeaderComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderComponent","href":null},{"type":"text","text":{"content":" への参照はなくなり、ライブラリのユーザーが ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" への参照はなくなり、ライブラリのユーザーが ","href":null},{"type":"text","text":{"content":"<lib-card-header>","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"<lib-card-header>","href":null},{"type":"text","text":{"content":" コンポーネントを呼び出したときだけ ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" コンポーネントを呼び出したときだけ ","href":null},{"type":"text","text":{"content":"CardHeaderToken","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderToken","href":null},{"type":"text","text":{"content":" に対して ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" に対して ","href":null},{"type":"text","text":{"content":"CardHeaderComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderComponent","href":null},{"type":"text","text":{"content":" クラスのインスタンスが提供されることになる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" クラスのインスタンスが提供されることになる。","href":null}],"color":"default"}},{"object":"block","id":"a8e6fb59-e2f6-4532-a3ab-ba97c0cd47b0","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"@ContentChild()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ContentChild()","href":null},{"type":"text","text":{"content":" や ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" や ","href":null},{"type":"text","text":{"content":"@ViewChild()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ViewChild()","href":null},{"type":"text","text":{"content":" の引数としてDIトークンを渡せるようになるのがバージョン 10.1.0からなので、このアプローチが取れるのは","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" の引数としてDIトークンを渡せるようになるのがバージョン 10.1.0からなので、このアプローチが取れるのは","href":null},{"type":"text","text":{"content":"バージョン 10.1.0以降","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"バージョン 10.1.0以降","href":null},{"type":"text","text":{"content":"になる（ ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"になる（ ","href":null},{"type":"text","text":{"content":"as any","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"as any","href":null},{"type":"text","text":{"content":" で突破する手法はあるが）。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" で突破する手法はあるが）。","href":null}],"color":"default"}},{"object":"block","id":"4ebbc011-97a2-497f-95d0-dab897f4b1a2","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"feat(core): support injection token as predicate in queries (#37506) · angular/angular@97dc85b","link":{"url":"https://github.com/angular/angular/commit/97dc85ba5e4eb6cfa741908a04cfccb1459cec9b"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"feat(core): support injection token as predicate in queries (#37506) · angular/angular@97dc85b","href":"https://github.com/angular/angular/commit/97dc85ba5e4eb6cfa741908a04cfccb1459cec9b"}],"color":"default"}},{"object":"block","id":"7b4690a8-fa49-48ca-a9fc-48bf77b395bb","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"なぜ今なのか、これまでの経緯","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"なぜ今なのか、これまでの経緯","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"f418f599-cb51-4ae8-92d3-d5a083203392","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"この問題は昔からずっと存在したが、実はバージョン8まではそれほど重大な問題ではなかった。なぜかというとバージョン8以前、つまりIvy以前 (ViewEngine, VE) はAOTコンパイルによってテンプレートコンパイルされた結果の生成コードが、もとのコンポーネントとは別のクラス実体をもっていたからだ。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"この問題は昔からずっと存在したが、実はバージョン8まではそれほど重大な問題ではなかった。なぜかというとバージョン8以前、つまりIvy以前 (ViewEngine, VE) はAOTコンパイルによってテンプレートコンパイルされた結果の生成コードが、もとのコンポーネントとは別のクラス実体をもっていたからだ。","href":null}],"color":"default"}},{"object":"block","id":"48ef0d62-5aa3-4351-8b18-f476f8769e5f","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"ViewEngineでは ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ViewEngineでは ","href":null},{"type":"text","text":{"content":"CardComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardComponent","href":null},{"type":"text","text":{"content":" クラスのデコレーターとそのメタデータをもとに ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" クラスのデコレーターとそのメタデータをもとに ","href":null},{"type":"text","text":{"content":"CardComponentNgFactory","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardComponentNgFactory","href":null},{"type":"text","text":{"content":" クラスが生成される。そして、JavaScriptとしてコードサイズが大きいのはほとんどの場合NgFactory側である。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" クラスが生成される。そして、JavaScriptとしてコードサイズが大きいのはほとんどの場合NgFactory側である。","href":null}],"color":"default"}},{"object":"block","id":"c9dc36d7-a729-4962-a160-97d0e424cd49","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"つまり上記の例でいえば、 たとえ ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"つまり上記の例でいえば、 たとえ ","href":null},{"type":"text","text":{"content":"CardComponentNgFactory","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardComponentNgFactory","href":null},{"type":"text","text":{"content":" クラスが ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" クラスが ","href":null},{"type":"text","text":{"content":"CardHeaderComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderComponent","href":null},{"type":"text","text":{"content":" への参照を持っていたとしても、","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" への参照を持っていたとしても、","href":null},{"type":"text","text":{"content":"CardHeaderComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderComponent","href":null},{"type":"text","text":{"content":" そのものが大きくないために問題にならなかったのだ。サイズが大きいのは ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" そのものが大きくないために問題にならなかったのだ。サイズが大きいのは ","href":null},{"type":"text","text":{"content":"CardHeaderComponenNgFactory","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderComponenNgFactory","href":null},{"type":"text","text":{"content":" のほうで、NgFactoryは テンプレート中で ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" のほうで、NgFactoryは テンプレート中で ","href":null},{"type":"text","text":{"content":"<lib-card-header>","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"<lib-card-header>","href":null},{"type":"text","text":{"content":" を使わない限り参照されないため、不完全ではあるがTree-ShakingできていたのがViewEngine方式だった。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を使わない限り参照されないため、不完全ではあるがTree-ShakingできていたのがViewEngine方式だった。","href":null}],"color":"default"}},{"object":"block","id":"df4598da-15fd-4ab5-a2fe-343b7b75498d","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"バージョン9からデフォルトになったIvy方式のAOTコンパイルは、生成コードを ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"バージョン9からデフォルトになったIvy方式のAOTコンパイルは、生成コードを ","href":null},{"type":"text","text":{"content":"もとのクラスの静的フィールドとして合成する","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"もとのクラスの静的フィールドとして合成する","href":null},{"type":"text","text":{"content":"。よって AOTコンパイルすると ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"。よって AOTコンパイルすると ","href":null},{"type":"text","text":{"content":"CardHeaderComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardHeaderComponent","href":null},{"type":"text","text":{"content":" そのもののサイズが大きくなり、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" そのもののサイズが大きくなり、 ","href":null},{"type":"text","text":{"content":"CardComponent","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"CardComponent","href":null},{"type":"text","text":{"content":" に巻き込まれて一緒にバンドルされるサイズが顕著に大きくなる。いままで行なわれていた生成コードのTree-ShakingがIvyによりなくなってしまった。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" に巻き込まれて一緒にバンドルされるサイズが顕著に大きくなる。いままで行なわれていた生成コードのTree-ShakingがIvyによりなくなってしまった。","href":null}],"color":"default"}},{"object":"block","id":"0571a0e6-a440-438a-9b68-20051e870ca1","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"つまり、Lightweight Injection TokenはViewEngine時代には顕在化していなかったがIvyによってクリティカルになった問題を解決するために編み出された、","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"つまり、Lightweight Injection TokenはViewEngine時代には顕在化していなかったがIvyによってクリティカルになった問題を解決するために編み出された、","href":null},{"type":"text","text":{"content":"Ivy時代のAngualrライブラリ実装パターン","link":null},"annotations":{"bold":true,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Ivy時代のAngualrライブラリ実装パターン","href":null},{"type":"text","text":{"content":"である。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"である。","href":null}],"color":"default"}},{"object":"block","id":"0bee958c-c615-45da-b51f-9eb54ddc20c1","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"もっともポピュラーなAngularのコンポーネントライブラリであるAngular Materialではバージョン9リリース時からバンドルサイズの増加が報告されており、その解消の過程でAngularチームが辿り着いた答えである。現在Angular ComponentsチームはAngular Materialの各コンポーネントをLightweight Injection Tokenパターンに置き換える作業を進めている。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"もっともポピュラーなAngularのコンポーネントライブラリであるAngular Materialではバージョン9リリース時からバンドルサイズの増加が報告されており、その解消の過程でAngularチームが辿り着いた答えである。現在Angular ComponentsチームはAngular Materialの各コンポーネントをLightweight Injection Tokenパターンに置き換える作業を進めている。","href":null}],"color":"default"}},{"object":"block","id":"ebae5016-7a00-497f-adf6-22021535343c","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T05:21:00.000Z","last_edited_time":"2023-05-21T05:21:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"480a5159-f46b-4a81-895c-9d56a207d9cc"},"has_children":false,"archived":false,"type":"link_preview","link_preview":{"url":"https://github.com/angular/components/issues/19610"}},{"object":"block","id":"fd0888d7-14d4-497f-a316-ce923b2ee2ad","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"Use light-weight injection pattern for optimized tree-shaking/bundle size · Issue #19576 · angular/components","link":{"url":"https://github.com/angular/components/issues/19576"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Use light-weight injection pattern for optimized tree-shaking/bundle size · Issue #19576 · angular/components","href":"https://github.com/angular/components/issues/19576"}],"color":"default"}},{"object":"block","id":"2c7ab677-f1c0-4fa0-b1fc-3b588b845069","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"コンポーネント以外のLightweight Injection Token","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"コンポーネント以外のLightweight Injection Token","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"e8d02eb4-dd1c-4f3f-9900-3b98b792e4a5","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"ところで、 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ところで、 ","href":null},{"type":"text","text":{"content":"@ContentChild()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ContentChild()","href":null},{"type":"text","text":{"content":" などの走査条件でなくとも、通常のDIの中でもオプショナルなものについてはLightweight Injection Tokenパターンを使うべきである。 ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" などの走査条件でなくとも、通常のDIの中でもオプショナルなものについてはLightweight Injection Tokenパターンを使うべきである。 ","href":null},{"type":"text","text":{"content":"@Optional()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@Optional()","href":null},{"type":"text","text":{"content":" を使っていてもそのトークンの参照は残るためTree-Shakingはできない。コンストラクタDIでは型注釈部分にしか参照がないためコンパイルすれば消えそうに見えるが、コンストラクタ引数の型注釈はAOTコンパイル時に自動的に ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" を使っていてもそのトークンの参照は残るためTree-Shakingはできない。コンストラクタDIでは型注釈部分にしか参照がないためコンパイルすれば消えそうに見えるが、コンストラクタ引数の型注釈はAOTコンパイル時に自動的に ","href":null},{"type":"text","text":{"content":"@Inject()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@Inject()","href":null},{"type":"text","text":{"content":" デコレーターに変換されるため、実体参照をもつのである。つまりこれも ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" デコレーターに変換されるため、実体参照をもつのである。つまりこれも ","href":null},{"type":"text","text":{"content":"@ContentChild()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"@ContentChild()","href":null},{"type":"text","text":{"content":" と全く同じ構造であり、同じ問題をもちうる。ライブラリ作者であればオプショナルなプロバイダーのトークンは可能な限り軽量にしておくべきだろう。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" と全く同じ構造であり、同じ問題をもちうる。ライブラリ作者であればオプショナルなプロバイダーのトークンは可能な限り軽量にしておくべきだろう。","href":null}],"color":"default"}},{"object":"block","id":"61d0ead1-fa66-4f95-826b-00595d977453","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"class MyComponent {\n  constructor(@Optional() srv: OptionalService) {}\n}\n\n// Same\nclass MyComponent {\n  constructor(@Optional() @Inject(OptionalService) srv: OptionalService) {}\n}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"class MyComponent {\n  constructor(@Optional() srv: OptionalService) {}\n}\n\n// Same\nclass MyComponent {\n  constructor(@Optional() @Inject(OptionalService) srv: OptionalService) {}\n}","href":null}],"language":"plain text"}},{"object":"block","id":"9d287b69-45b3-4165-a2b3-adfdc6366971","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"ちなみにコンポーネントのLightweight Injection Tokenとして ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"ちなみにコンポーネントのLightweight Injection Tokenとして ","href":null},{"type":"text","text":{"content":"InjectionToken","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"InjectionToken","href":null},{"type":"text","text":{"content":" オブジェクトを使うこともできるはずだ。公式ドキュメントでは抽象クラスの例が紹介されているが、どちらが定着するかは今後のコミュニティでの受け入れられ方次第だろう。ただ、トークンの抽象クラスとコンポーネントクラスを継承関係にするとそのままコンポーネントのAPI定義として利用もできるため、おそらくは抽象クラスのほうが便利な場面は多そうだ。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" オブジェクトを使うこともできるはずだ。公式ドキュメントでは抽象クラスの例が紹介されているが、どちらが定着するかは今後のコミュニティでの受け入れられ方次第だろう。ただ、トークンの抽象クラスとコンポーネントクラスを継承関係にするとそのままコンポーネントのAPI定義として利用もできるため、おそらくは抽象クラスのほうが便利な場面は多そうだ。","href":null}],"color":"default"}},{"object":"block","id":"bb188918-5c18-4471-ab28-6c33f9b90b88","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"rich_text":[{"type":"text","text":{"content":"const CardHeaderToken\n  = new InjectionToken<CardHeaderComponent>(\"CardHeaderComponent\");","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"const CardHeaderToken\n  = new InjectionToken<CardHeaderComponent>(\"CardHeaderComponent\");","href":null}],"language":"plain text"}},{"object":"block","id":"e1c6dcb1-8baf-4680-a9b2-5c6d87003ee8","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T05:22:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"https://angular.io/guide/dependency-injection-providers#non-class-dependencies","link":{"url":"https://angular.io/guide/dependency-injection-providers#non-class-dependencies"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"https://angular.io/guide/dependency-injection-providers#non-class-dependencies","href":"https://angular.io/guide/dependency-injection-providers#non-class-dependencies"},{"type":"text","text":{"content":" ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" ","href":null}],"color":"default"}},{"object":"block","id":"c2ad3e5f-5932-4506-baee-ccd568cccc74","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"rich_text":[{"type":"text","text":{"content":"参考リンク","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"参考リンク","href":null}],"is_toggleable":false,"color":"default"}},{"object":"block","id":"3c0b36bd-d545-46c7-aa2c-e8e242bde69f","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"rich_text":[{"type":"text","text":{"content":"以下に参考リンクをまとめる。","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"以下に参考リンクをまとめる。","href":null}],"color":"default"}},{"object":"block","id":"12b91024-37e8-473b-b20e-18c6009c5934","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"Misko HeveryによるDesign Doc [https://hackmd.io/@mhevery/SyqDjUlrU](https://hackmd.io/@mhevery/SyqDjUlrU)","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Misko HeveryによるDesign Doc [https://hackmd.io/@mhevery/SyqDjUlrU](https://hackmd.io/@mhevery/SyqDjUlrU)","href":null}],"color":"default"}},{"object":"block","id":"6dbe7dbb-c117-4ff9-bec7-51410ed4b8c3","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"公式ドキュメントへの追加PR ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"公式ドキュメントへの追加PR ","href":null},{"type":"text","text":{"content":"https://github.com/angular/angular/pull/36144","link":{"url":"https://github.com/angular/angular/pull/36144"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"https://github.com/angular/angular/pull/36144","href":"https://github.com/angular/angular/pull/36144"}],"color":"default"}},{"object":"block","id":"6df31ea3-3117-453a-8b5b-5fbd2c0dd0dc","parent":{"type":"page_id","page_id":"66159df0-e348-42f1-9a27-5319c346cdc3"},"created_time":"2023-05-21T00:20:00.000Z","last_edited_time":"2023-05-21T00:20:00.000Z","created_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"last_edited_by":{"object":"user","id":"f4f222d4-d508-405d-ba6c-da82ee26ee54"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"rich_text":[{"type":"text","text":{"content":"Angular MaterialのIssue ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Angular MaterialのIssue ","href":null},{"type":"text","text":{"content":"https://github.com/angular/components/issues/19576","link":{"url":"https://github.com/angular/components/issues/19576"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"https://github.com/angular/components/issues/19576","href":"https://github.com/angular/components/issues/19576"}],"color":"default"}}]